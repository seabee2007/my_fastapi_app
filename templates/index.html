<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>CQI Assessment Tool</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Google Font for a modern look -->
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary-color: #007bff;
      --primary-color-hover: #0056b3;
      --bg-color: #f4f4f4;
      --container-bg: #ffffff;
      --border-color: #ccc;
      --border-radius: 5px;
      --input-padding: 10px;
      --max-container-width: 900px;
      --font-color: #333;
    }
    body {
      font-family: 'Roboto', sans-serif;
      background-color: var(--bg-color);
      margin: 0;
      padding: 20px;
      color: var(--font-color);
    }
    .container {
      max-width: var(--max-container-width);
      margin: 0 auto;
      background: var(--container-bg);
      padding: 30px;
      box-shadow: 0 0 15px rgba(0,0,0,0.1);
      border-radius: var(--border-radius);
    }
    h1, h2, h3 {
      text-align: center;
      margin-bottom: 15px;
    }
    .item-section {
      margin-bottom: 20px;
      padding: 15px;
      background: #fafafa;
      border: 1px solid #eee;
      border-radius: var(--border-radius);
    }
    label {
      font-weight: 500;
      display: block;
      margin-bottom: 5px;
    }
    input[type="text"],
    input[type="date"],
    input[type="number"],
    select,
    textarea {
      width: 100%;
      padding: var(--input-padding);
      margin-top: 5px;
      margin-bottom: 15px;
      border: 1px solid var(--border-color);
      border-radius: var(--border-radius);
      font-size: 1em;
      box-sizing: border-box;
    }
    input[type="radio"] {
      margin-right: 5px;
    }
    button {
      background-color: var(--primary-color);
      color: #fff;
      border: none;
      padding: 12px 20px;
      border-radius: var(--border-radius);
      cursor: pointer;
      font-size: 1em;
      transition: background-color 0.3s ease;
      display: block;
      margin: 20px auto;
    }
    button:hover {
      background-color: var(--primary-color-hover);
    }
    @media (max-width: 600px) {
      .container {
        padding: 20px;
      }
      input, select, textarea, button {
        font-size: 0.9em;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>CQI Assessment Tool</h1>
    
    <!-- Display validation errors if any -->
    {% if errors %}
      <div style="color: red; margin-bottom: 20px;">
        <ul>
          {% for error in errors %}
            <li>{{ error }}</li>
          {% endfor %}
        </ul>
      </div>
    {% endif %}

    <form method="post" action="/submit_assessment">
      <!-- Project Information -->
      <h2>Project Information</h2>
      <div class="item-section">
        <label>Project Name:</label>
        <input type="text" name="project_name" value="{{ form_data.project_name if form_data and form_data.project_name is defined else '' }}">
      </div>
      <div class="item-section">
        <label>Battalion:</label>
        <input type="text" name="battalion" value="{{ form_data.battalion if form_data and form_data.battalion is defined else '' }}">
      </div>
      <div class="item-section">
        <label>OIC:</label>
        <input type="text" name="oic_name" value="{{ form_data.oic_name if form_data and form_data.oic_name is defined else '' }}">
      </div>
      <div class="item-section">
        <label>AOIC:</label>
        <input type="text" name="aoic_name" value="{{ form_data.aoic_name if form_data and form_data.aoic_name is defined else '' }}">
      </div>
      <div class="item-section">
        <label>Start Date:</label>
        <input type="date" name="start_date" value="{{ form_data.start_date if form_data and form_data.start_date is defined else '' }}">
      </div>
      <div class="item-section">
        <label>Planned Start Date:</label>
        <input type="date" name="planned_start" value="{{ form_data.planned_start if form_data and form_data.planned_start is defined else '' }}">
      </div>
      <div class="item-section">
        <label>Planned Completion Date:</label>
        <input type="date" name="planned_completion" value="{{ form_data.planned_completion if form_data and form_data.planned_completion is defined else '' }}">
      </div>
      <div class="item-section">
        <label>Actual Completion Date:</label>
        <input type="date" name="actual_completion" value="{{ form_data.actual_completion if form_data and form_data.actual_completion is defined else '' }}">
      </div>

      <h2>Assessment Inputs</h2>
      <!-- Item 1 – Self Assessment -->
      <div class="item-section">
        <h3>Item 1 – Self Assessment</h3>
        <p>Has the unit completed an initial self-assessment CQI checklist? (Yes = 2 pts, No = 0 pts)</p>
        <input type="radio" name="item1" value="Yes" {% if form_data and form_data.item1=='Yes' %}checked{% endif %}> Yes
        <input type="radio" name="item1" value="No" {% if not form_data or form_data.item1!='Yes' %}checked{% endif %}> No
        <label>Comment:</label>
        <textarea name="comment_item1">{{ form_data.comment_item1 if form_data and form_data.comment_item1 is defined else '' }}</textarea>
      </div>

      <!-- Item 2 – Self Assessment Submission -->
      <div class="item-section">
        <h3>Item 2 – Self Assessment Submission</h3>
        <p>Were the self-assessment results submitted to 30 NCR SharePoint at least 7 days prior to inspection? (Yes = 2 pts, No = 0 pts)</p>
        <input type="radio" name="item2" value="Yes" {% if form_data and form_data.item2=='Yes' %}checked{% endif %}> Yes
        <input type="radio" name="item2" value="No" {% if not form_data or form_data.item2!='Yes' %}checked{% endif %}> No
        <label>Comment:</label>
        <textarea name="comment_item2">{{ form_data.comment_item2 if form_data and form_data.comment_item2 is defined else '' }}</textarea>
      </div>

      <!-- Item 3 – Notice to Proceed (NTP) -->
      <div class="item-section">
        <h3>Item 3 – Notice to Proceed (NTP)</h3>
        <p>Has a project confirmation/turnover brief been conducted with 30 NCR resulting in receiving a NTP? (Yes = 4 pts, No = 0 pts)</p>
        <input type="radio" name="item3" value="Yes" {% if form_data and form_data.item3=='Yes' %}checked{% endif %}> Yes
        <input type="radio" name="item3" value="No" {% if not form_data or form_data.item3!='Yes' %}checked{% endif %}> No
        <label>Comment:</label>
        <textarea name="comment_item3">{{ form_data.comment_item3 if form_data and form_data.comment_item3 is defined else '' }}</textarea>
      </div>

      <!-- Item 4 – Project Schedule (Dynamic Calculation) -->
      <div class="item-section">
        <h3>Item 4 – Project Schedule</h3>
        <p>Is the unit achieving the given tasking? (Exact = 16 pts; Within deviation = 12 pts; Outside deviation = 4 pts; Not monitored = 0 pts)</p>
        <label>Total Project Mandays:</label>
        <input type="number" id="total_md" name="total_md" value="1000" step="1">
        <label>Planned Work-in-Place (%):</label>
        <input type="number" id="planned_wip" name="planned_wip" value="100" step="1">
        <label>Actual Work-in-Place (%):</label>
        <input type="number" id="actual_wip" name="actual_wip" value="100" step="1">
        <p id="item4_score_display">Calculated Score for Item 4: 16</p>
        <input type="hidden" id="item4_score" name="item4_score" value="16">
        <div id="item4_comment_div" style="display:none;">
          <label>Comment (if not perfect):</label>
          <textarea id="comment_item4" name="comment_item4">{{ form_data.comment_item4 if form_data and form_data.comment_item4 is defined else '' }}</textarea>
        </div>
      </div>

      <!-- Item 5 – Project Management -->
      <div class="item-section">
        <h3>Item 5 – Project Management</h3>
        <p>Is a project management tool/CPM being utilized? (Yes = 2 pts, No = 0 pts)</p>
        <input type="radio" name="item5" value="Yes" {% if form_data and form_data.item5=='Yes' %}checked{% endif %}> Yes
        <input type="radio" name="item5" value="No" {% if not form_data or form_data.item5!='Yes' %}checked{% endif %}> No
        <label>Comment:</label>
        <textarea name="comment_item5">{{ form_data.comment_item5 if form_data and form_data.comment_item5 is defined else '' }}</textarea>
      </div>

      <!-- Item 6 – QA for 30 NCR Detail Sites -->
      <div class="item-section">
        <h3>Item 6 – QA for 30 NCR Detail Sites</h3>
        <p>QA involvement: (4 pts = Zero discrepancies; 3 pts = Acceptable; 2 pts = Multiple discrepancies; 0 pts = No QA involvement)</p>
        <select name="item6">
          <option value="4" {% if form_data and form_data.item6=='4' %}selected{% endif %}>4</option>
          <option value="3" {% if form_data and form_data.item6=='3' %}selected{% endif %}>3</option>
          <option value="2" {% if form_data and form_data.item6=='2' %}selected{% endif %}>2</option>
          <option value="0" {% if form_data and form_data.item6=='0' %}selected{% endif %}>0</option>
        </select>
        <label>Comment:</label>
        <textarea name="comment_item6">{{ form_data.comment_item6 if form_data and form_data.comment_item6 is defined else '' }}</textarea>
      </div>

      <!-- Item 7 & 8 – FAR/RFI -->
      <div class="item-section">
        <h3>Item 7 &amp; 8 – FAR/RFI</h3>
        <p>Inspect FAR/RFI log for continuity. (4 pts = 100% logged; 3 pts = Acceptable; 2 pts = Missing; 0 pts = Not tracked)</p>
        <select name="item78">
          <option value="4" {% if form_data and form_data.item78=='4' %}selected{% endif %}>4</option>
          <option value="3" {% if form_data and form_data.item78=='3' %}selected{% endif %}>3</option>
          <option value="2" {% if form_data and form_data.item78=='2' %}selected{% endif %}>2</option>
          <option value="0" {% if form_data and form_data.item78=='0' %}selected{% endif %}>0</option>
        </select>
        <label>Comment:</label>
        <textarea name="comment_item78">{{ form_data.comment_item78 if form_data and form_data.comment_item78 is defined else '' }}</textarea>
      </div>

      <!-- Item 9 – DFOW Sheet -->
      <div class="item-section">
        <h3>Item 9 – DFOW Sheet</h3>
        <p>Ensure the DFOW sheet is accurate and updated. (4 pts = Accurate; 3 pts = Acceptable; 2 pts = Incorrect; 0 pts = Blank)</p>
        <select name="item9">
          <option value="4" {% if form_data and form_data.item9=='4' %}selected{% endif %}>4</option>
          <option value="3" {% if form_data and form_data.item9=='3' %}selected{% endif %}>3</option>
          <option value="2" {% if form_data and form_data.item9=='2' %}selected{% endif %}>2</option>
          <option value="0" {% if form_data and form_data.item9=='0' %}selected{% endif %}>0</option>
        </select>
        <label>Comment:</label>
        <textarea name="comment_item9">{{ form_data.comment_item9 if form_data and form_data.comment_item9 is defined else '' }}</textarea>
      </div>

      <!-- Item 10 – Turnover Projects -->
      <div class="item-section">
        <h3>Item 10 – Turnover Projects</h3>
        <p>Review turnover memorandum. (4 pts = Validated discrepancies with rework plan; 0 pts = No documentation)</p>
        <select name="item10">
          <option value="4" {% if form_data and form_data.item10=='4' %}selected{% endif %}>4</option>
          <option value="0" {% if form_data and form_data.item10=='0' %}selected{% endif %}>0</option>
          <option value="N/A" {% if form_data and form_data.item10=='N/A' %}selected{% endif %}>N/A</option>
        </select>
        <label>Comment:</label>
        <textarea name="comment_item10">{{ form_data.comment_item10 if form_data and form_data.comment_item10 is defined else '' }}</textarea>
      </div>

      <!-- Item 11 – Funds Provided -->
      <div class="item-section">
        <h3>Item 11 – Funds Provided</h3>
        <p>Are project funds tracked? (4 pts = Monitored; 0 pts = Not monitored)</p>
        <input type="radio" name="item11" value="Yes" {% if form_data and form_data.item11=='Yes' %}checked{% endif %}> Yes
        <input type="radio" name="item11" value="No" {% if not form_data or form_data.item11!='Yes' %}checked{% endif %}> No
        <label>Comment:</label>
        <textarea name="comment_item11">{{ form_data.comment_item11 if form_data and form_data.comment_item11 is defined else '' }}</textarea>
      </div>

      <!-- Item 12 – Estimate at Completion Cost (EAC) -->
      <div class="item-section">
        <h3>Item 12 – Estimate at Completion Cost (EAC)</h3>
        <p>EAC accuracy. (4 pts = Accurate; 3 pts = Acceptable; 2 pts = Low accuracy; 0 pts = ≤59% accuracy)</p>
        <select name="item12">
          <option value="4" {% if form_data and form_data.item12=='4' %}selected{% endif %}>4</option>
          <option value="3" {% if form_data and form_data.item12=='3' %}selected{% endif %}>3</option>
          <option value="2" {% if form_data and form_data.item12=='2' %}selected{% endif %}>2</option>
          <option value="0" {% if form_data and form_data.item12=='0' %}selected{% endif %}>0</option>
        </select>
        <label>Comment:</label>
        <textarea name="comment_item12">{{ form_data.comment_item12 if form_data and form_data.comment_item12 is defined else '' }}</textarea>
      </div>

      <!-- Item 13 – Current Expenditures -->
      <div class="item-section">
        <h3>Item 13 – Current Expenditures</h3>
        <p>Verify current expenditures. (4 pts = Accurate; 3 pts = Acceptable; 2 pts = Discrepancies; 0 pts = ≤59% accuracy)</p>
        <select name="item13">
          <option value="4" {% if form_data and form_data.item13=='4' %}selected{% endif %}>4</option>
          <option value="3" {% if form_data and form_data.item13=='3' %}selected{% endif %}>3</option>
          <option value="2" {% if form_data and form_data.item13=='2' %}selected{% endif %}>2</option>
          <option value="0" {% if form_data and form_data.item13=='0' %}selected{% endif %}>0</option>
        </select>
        <label>Comment:</label>
        <textarea name="comment_item13">{{ form_data.comment_item13 if form_data and form_data.comment_item13 is defined else '' }}</textarea>
      </div>

      <!-- Item 14 – Project Material Status Report (PMSR) -->
      <div class="item-section">
        <h3>Item 14 – Project Material Status Report (PMSR)</h3>
        <p>Inspect PMSR. (10 pts = 100% valid; 8 pts = Acceptable; 4 pts = Discrepancies; 2/0 pts otherwise)</p>
        <select name="item14">
          <option value="10" {% if form_data and form_data.item14=='10' %}selected{% endif %}>10</option>
          <option value="8" {% if form_data and form_data.item14=='8' %}selected{% endif %}>8</option>
          <option value="4" {% if form_data and form_data.item14=='4' %}selected{% endif %}>4</option>
          <option value="2" {% if form_data and form_data.item14=='2' %}selected{% endif %}>2</option>
          <option value="0" {% if form_data and form_data.item14=='0' %}selected{% endif %}>0</option>
        </select>
        <label>Comment:</label>
        <textarea name="comment_item14">{{ form_data.comment_item14 if form_data and form_data.comment_item14 is defined else '' }}</textarea>
      </div>

      <!-- Item 15 – Report Submission -->
      <div class="item-section">
        <h3>Item 15 – Report Submission</h3>
        <p>Are PMSR and EAC reports routed monthly? (2 pts = Yes; 0 pts = No)</p>
        <input type="radio" name="item15" value="Yes" {% if form_data and form_data.item15=='Yes' %}checked{% endif %}> Yes
        <input type="radio" name="item15" value="No" {% if not form_data or form_data.item15!='Yes' %}checked{% endif %}> No
        <label>Comment:</label>
        <textarea name="comment_item15">{{ form_data.comment_item15 if form_data and form_data.comment_item15 is defined else '' }}</textarea>
      </div>

      <!-- Item 16 – Materials On-Hand -->
      <div class="item-section">
        <h3>Item 16 – Materials On-Hand</h3>
        <p>Materials on-hand verification. (10 pts = Organized; 8 pts = Minor issues; 4 pts = Multiple issues; 0 pts = Unsatisfactory)</p>
        <select name="item16">
          <option value="10" {% if form_data and form_data.item16=='10' %}selected{% endif %}>10</option>
          <option value="8" {% if form_data and form_data.item16=='8' %}selected{% endif %}>8</option>
          <option value="4" {% if form_data and form_data.item16=='4' %}selected{% endif %}>4</option>
          <option value="0" {% if form_data and form_data.item16=='0' %}selected{% endif %}>0</option>
        </select>
        <label>Comment:</label>
        <textarea name="comment_item16">{{ form_data.comment_item16 if form_data and form_data.comment_item16 is defined else '' }}</textarea>
      </div>

      <!-- Item 17 – DD Form 200 -->
      <div class="item-section">
        <h3>Item 17 – DD Form 200</h3>
        <p>DD Form 200 status. (2 pts = Correct; 0 pts = Not maintained)</p>
        <input type="radio" name="item17" value="Yes" {% if form_data and form_data.item17=='Yes' %}checked{% endif %}> Yes
        <input type="radio" name="item17" value="No" {% if not form_data or form_data.item17!='Yes' %}checked{% endif %}> No
        <label>Comment:</label>
        <textarea name="comment_item17">{{ form_data.comment_item17 if form_data and form_data.comment_item17 is defined else '' }}</textarea>
      </div>

      <!-- Item 18 – Borrowed Material Tickler File -->
      <div class="item-section">
        <h3>Item 18 – Borrowed Material Tickler File</h3>
        <p>Borrow log verification. (2 pts = Valid; 0 pts = Not managed)</p>
        <input type="radio" name="item18" value="Yes" {% if form_data and form_data.item18=='Yes' %}checked{% endif %}> Yes
        <input type="radio" name="item18" value="No" {% if not form_data or form_data.item18!='Yes' %}checked{% endif %}> No
        <label>Comment:</label>
        <textarea name="comment_item18">{{ form_data.comment_item18 if form_data and form_data.comment_item18 is defined else '' }}</textarea>
      </div>

      <!-- Item 19 – Project Brief -->
      <div class="item-section">
        <h3>Item 19 – Project Brief</h3>
        <p>Project brief quality. (5 pts = Detailed; 3 pts = Acceptable; 2/0 pts otherwise)</p>
        <select name="item19">
          <option value="5" {% if form_data and form_data.item19=='5' %}selected{% endif %}>5</option>
          <option value="3" {% if form_data and form_data.item19=='3' %}selected{% endif %}>3</option>
          <option value="2" {% if form_data and form_data.item19=='2' %}selected{% endif %}>2</option>
          <option value="0" {% if form_data and form_data.item19=='0' %}selected{% endif %}>0</option>
        </select>
        <label>Comment:</label>
        <textarea name="comment_item19">{{ form_data.comment_item19 if form_data and form_data.comment_item19 is defined else '' }}</textarea>
      </div>

      <!-- Item 20 – Calculate Manday Capability -->
      <div class="item-section">
        <h3>Item 20 – Calculate Manday Capability</h3>
        <p>Crew composition &amp; MD capability. (6 pts = Matches; 4/2/0 pts otherwise)</p>
        <select name="item20">
          <option value="6" {% if form_data and form_data.item20=='6' %}selected{% endif %}>6</option>
          <option value="4" {% if form_data and form_data.item20=='4' %}selected{% endif %}>4</option>
          <option value="2" {% if form_data and form_data.item20=='2' %}selected{% endif %}>2</option>
          <option value="0" {% if form_data and form_data.item20=='0' %}selected{% endif %}>0</option>
        </select>
        <label>Comment:</label>
        <textarea name="comment_item20">{{ form_data.comment_item20 if form_data and form_data.comment_item20 is defined else '' }}</textarea>
      </div>

      <!-- Item 21 – Equipment -->
      <div class="item-section">
        <h3>Item 21 – Equipment</h3>
        <p>Equipment adequacy. (6 pts = All onsite; 4 pts = Acceptable; 2/0 pts otherwise)</p>
        <select name="item21">
          <option value="6" {% if form_data and form_data.item21=='6' %}selected{% endif %}>6</option>
          <option value="4" {% if form_data and form_data.item21=='4' %}selected{% endif %}>4</option>
          <option value="2" {% if form_data and form_data.item21=='2' %}selected{% endif %}>2</option>
          <option value="0" {% if form_data and form_data.item21=='0' %}selected{% endif %}>0</option>
        </select>
        <label>Comment:</label>
        <textarea name="comment_item21">{{ form_data.comment_item21 if form_data and form_data.comment_item21 is defined else '' }}</textarea>
      </div>

      <!-- Item 22 – CASS Spot Check -->
      <div class="item-section">
        <h3>Item 22 – CASS Spot Check</h3>
        <p>CASS review. (12 pts = 100% compliant; 8/4/0 pts otherwise)</p>
        <select name="item22">
          <option value="12" {% if form_data and form_data.item22=='12' %}selected{% endif %}>12</option>
          <option value="8" {% if form_data and form_data.item22=='8' %}selected{% endif %}>8</option>
          <option value="4" {% if form_data and form_data.item22=='4' %}selected{% endif %}>4</option>
          <option value="0" {% if form_data and form_data.item22=='0' %}selected{% endif %}>0</option>
        </select>
        <label>Comment:</label>
        <textarea name="comment_item22">{{ form_data.comment_item22 if form_data and form_data.comment_item22 is defined else '' }}</textarea>
      </div>

      <!-- Item 23 – Designation Letters -->
      <div class="item-section">
        <h3>Item 23 – Designation Letters</h3>
        <p>Designation letters status. (5 pts = Current; 3 pts = Not up-to-date; 0 pts = Missing)</p>
        <select name="item23">
          <option value="5" {% if form_data and form_data.item23=='5' %}selected{% endif %}>5</option>
          <option value="3" {% if form_data and form_data.item23=='3' %}selected{% endif %}>3</option>
          <option value="0" {% if form_data and form_data.item23=='0' %}selected{% endif %}>0</option>
        </select>
        <label>Comment:</label>
        <textarea name="comment_item23">{{ form_data.comment_item23 if form_data and form_data.comment_item23 is defined else '' }}</textarea>
      </div>

      <!-- Item 24 – Job Box Review -->
      <div class="item-section">
        <h3>Item 24 – Job Box Review</h3>
        <p>Review jobsite board items. (20 pts maximum; deductions apply)</p>
        <select name="item24">
          <option value="20" {% if form_data and form_data.item24=='20' %}selected{% endif %}>20</option>
          <option value="0" {% if form_data and form_data.item24=='0' %}selected{% endif %}>0</option>
        </select>
        <label>Deduction:</label>
        <input type="number" name="deduction24" value="{{ form_data.deduction24 if form_data and form_data.deduction24 is defined else '0' }}" min="0" max="20">
        <label>Comment:</label>
        <textarea name="comment_item24">{{ form_data.comment_item24 if form_data and form_data.comment_item24 is defined else '' }}</textarea>
      </div>

      <!-- Item 25 – Review QC Package -->
      <div class="item-section">
        <h3>Item 25 – Review QC Package</h3>
        <p>QC package review. (8 pts = Comprehensive; 6/4/0 pts otherwise)</p>
        <select name="item25">
          <option value="8" {% if form_data and form_data.item25=='8' %}selected{% endif %}>8</option>
          <option value="6" {% if form_data and form_data.item25=='6' %}selected{% endif %}>6</option>
          <option value="4" {% if form_data and form_data.item25=='4' %}selected{% endif %}>4</option>
          <option value="0" {% if form_data and form_data.item25=='0' %}selected{% endif %}>0</option>
        </select>
        <label>Comment:</label>
        <textarea name="comment_item25">{{ form_data.comment_item25 if form_data and form_data.comment_item25 is defined else '' }}</textarea>
      </div>

      <!-- Item 26 – Submittals -->
      <div class="item-section">
        <h3>Item 26 – Submittals</h3>
        <p>Material submittals. (4 pts = Current; 2 pts = Not current; 0 pts = Not submitted)</p>
        <select name="item26">
          <option value="4" {% if form_data and form_data.item26=='4' %}selected{% endif %}>4</option>
          <option value="2" {% if form_data and form_data.item26=='2' %}selected{% endif %}>2</option>
          <option value="0" {% if form_data and form_data.item26=='0' %}selected{% endif %}>0</option>
        </select>
        <label>Comment:</label>
        <textarea name="comment_item26">{{ form_data.comment_item26 if form_data and form_data.comment_item26 is defined else '' }}</textarea>
      </div>

      <!-- Item 27a – QC Inspection Plan -->
      <div class="item-section">
        <h3>Item 27a – QC Inspection Plan</h3>
        <p>QC Inspection Plan. (10 pts = 100% quantifiable; 7/3/0 pts otherwise)</p>
        <select name="item27a">
          <option value="10" {% if form_data and form_data.item27a=='10' %}selected{% endif %}>10</option>
          <option value="8" {% if form_data and form_data.item27a=='8' %}selected{% endif %}>8</option>
          <option value="6" {% if form_data and form_data.item27a=='6' %}selected{% endif %}>6</option>
          <option value="0" {% if form_data and form_data.item27a=='0' %}selected{% endif %}>0</option>
        </select>
        <label>Comment:</label>
        <textarea name="comment_item27a">{{ form_data.comment_item27a if form_data and form_data.comment_item27a is defined else '' }}</textarea>
      </div>

      <!-- Item 27b – QC Inspection -->
      <div class="item-section">
        <h3>Item 27b – QC Inspection</h3>
        <p>On-site QC inspection. (5 pts = No discrepancies; 0 pts otherwise)</p>
        <select name="item27b">
          <option value="5" {% if form_data and form_data.item27b=='5' %}selected{% endif %}>5</option>
          <option value="0" {% if form_data and form_data.item27b=='0' %}selected{% endif %}>0</option>
        </select>
        <label>Comment:</label>
        <textarea name="comment_item27b">{{ form_data.comment_item27b if form_data and form_data.comment_item27b is defined else '' }}</textarea>
      </div>

      <!-- Item 28 – Job Box Review (QC) -->
      <div class="item-section">
        <h3>Item 28 – Job Box Review (QC)</h3>
        <p>Review QC plan and daily QC reports. (5 pts = Up-to-date; deductions apply)</p>
        <input type="number" name="deduction28" value="{{ form_data.deduction28 if form_data and form_data.deduction28 is defined else '0' }}" min="0" max="5">
        <label>Comment:</label>
        <textarea name="comment_item28">{{ form_data.comment_item28 if form_data and form_data.comment_item28 is defined else '' }}</textarea>
      </div>

      <!-- Item 29 – Job Box Review (Safety) -->
      <div class="item-section">
        <h3>Item 29 – Job Box Review (Safety)</h3>
        <p>Review safety plan, daily safety reports, and emergency contacts. (5 pts = Up-to-date; deductions apply)</p>
        <input type="number" name="deduction29" value="{{ form_data.deduction29 if form_data and form_data.deduction29 is defined else '0' }}" min="0" max="5">
        <label>Comment:</label>
        <textarea name="comment_item29">{{ form_data.comment_item29 if form_data and form_data.comment_item29 is defined else '' }}</textarea>
      </div>

      <button type="submit">Calculate Final Score</button>
    </form>
  </div>


<!-- Calculator Modal Trigger -->
<div id="calc-icon" class="calc-icon">🖩</div>

<!-- Calculator Modal Structure -->
<div id="calc-modal" class="calc-modal">
  <div class="calc-content">
    <span id="calc-close" class="calc-close">&times;</span>
    <h2>Calculator</h2>
    <input type="text" id="calc-display" placeholder="0" readonly style="width:100%; padding:10px; margin-bottom:10px; font-size:1em; text-align:right;">
    <div class="calc-buttons">
      <button class="calc-btn" data-value="7">7</button>
      <button class="calc-btn" data-value="8">8</button>
      <button class="calc-btn" data-value="9">9</button>
      <button class="calc-btn" data-value="/">/</button>

      <button class="calc-btn" data-value="4">4</button>
      <button class="calc-btn" data-value="5">5</button>
      <button class="calc-btn" data-value="6">6</button>
      <button class="calc-btn" data-value="*">*</button>

      <button class="calc-btn" data-value="1">1</button>
      <button class="calc-btn" data-value="2">2</button>
      <button class="calc-btn" data-value="3">3</button>
      <button class="calc-btn" data-value="-">-</button>

      <button class="calc-btn" data-value="0">0</button>
      <button class="calc-btn" data-value=".">.</button>
      <button class="calc-btn" data-value="%">%</button>
      <button class="calc-btn" data-value="+">+</button>

      <button class="calc-btn" id="calc-clear" style="grid-column: span 2;">C</button>
      <button class="calc-btn" id="calc-equals" style="grid-column: span 2;">=</button>
    </div>
  </div>
</div>

<!-- Calculator Modal Styles -->
<style>
  .calc-icon {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: var(--primary-color, #007bff);
    color: #fff;
    border-radius: 50%;
    width: 50px;
    height: 50px;
    text-align: center;
    line-height: 50px;
    cursor: pointer;
    z-index: 1000;
    box-shadow: 0 0 10px rgba(0,0,0,0.3);
  }
  .calc-modal {
    display: none;
    position: fixed;
    z-index: 1001;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0,0,0,0.4);
  }
  .calc-content {
    background-color: #fff;
    margin: 15% auto;
    padding: 20px;
    border: 1px solid #888;
    width: 90%;
    max-width: 400px;
    border-radius: 5px;
    text-align: center;
  }
  .calc-close {
    color: #aaa;
    float: right;
    font-size: 28px;
    font-weight: bold;
    cursor: pointer;
  }
  .calc-close:hover,
  .calc-close:focus {
    color: black;
    text-decoration: none;
  }
  .calc-buttons {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 10px;
  }
  .calc-btn {
    padding: 15px;
    font-size: 1.2em;
    cursor: pointer;
    border: 1px solid #ccc;
    background: #f4f4f4;
    border-radius: 5px;
  }
  .calc-btn:hover {
    background: #e0e0e0;
  }
</style>

<!-- Calculator Modal Script -->
<script>
  // Get modal elements
  var calcModal = document.getElementById("calc-modal");
  var calcIcon = document.getElementById("calc-icon");
  var calcClose = document.getElementById("calc-close");
  var calcDisplay = document.getElementById("calc-display");

  // Open modal when icon is clicked
  calcIcon.onclick = function() {
    calcModal.style.display = "block";
  };

  // Close modal when close button is clicked
  calcClose.onclick = function() {
    calcModal.style.display = "none";
    calcDisplay.value = "";
  };

  // Close modal if clicked outside the content area
  window.onclick = function(event) {
    if (event.target == calcModal) {
      calcModal.style.display = "none";
      calcDisplay.value = "";
    }
  };

  // Button click handling for numbers and operators
  document.querySelectorAll(".calc-btn").forEach(function(button) {
    button.addEventListener("click", function() {
      // Skip buttons that have specific functions (clear, equals)
      if (this.id === "calc-clear" || this.id === "calc-equals") return;
      var value = this.getAttribute("data-value");
      calcDisplay.value += value;
    });
  });

  // Clear button functionality
  document.getElementById("calc-clear").onclick = function() {
    calcDisplay.value = "";
  };

  // Equals button functionality
  document.getElementById("calc-equals").onclick = function() {
    try {
      // Evaluate the expression; using eval for simplicity—ensure inputs are trusted!
      calcDisplay.value = eval(calcDisplay.value);
    } catch (error) {
      calcDisplay.value = "Error";
    }
  };
</script>



  
  <script>
    function calculateItem4Score() {
      var total_md = parseFloat(document.getElementById("total_md").value) || 0;
      var planned_wip = parseFloat(document.getElementById("planned_wip").value) || 0;
      var actual_wip = parseFloat(document.getElementById("actual_wip").value) || 0;
      var allowed;
      if (total_md < 1000) {
          allowed = 10;
      } else if (total_md < 2000) {
          allowed = 5;
      } else {
          allowed = 2.5;
      }
      var diff = Math.abs(actual_wip - planned_wip);
      var score;
      if (diff === 0) {
          score = 16;
      } else if (diff <= allowed) {
          score = 12;
      } else {
          score = 4;
      }
      document.getElementById("item4_score_display").innerText = "Calculated Score for Item 4: " + score;
      document.getElementById("item4_score").value = score;
      if (score !== 16) {
          document.getElementById("item4_comment_div").style.display = "block";
      } else {
          document.getElementById("item4_comment_div").style.display = "none";
          document.getElementById("comment_item4").value = "";
      }
    }
    document.getElementById("total_md").addEventListener("input", calculateItem4Score);
    document.getElementById("planned_wip").addEventListener("input", calculateItem4Score);
    document.getElementById("actual_wip").addEventListener("input", calculateItem4Score);
  </script>
</body>
</html>
