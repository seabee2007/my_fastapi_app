<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>CQI Assessment Tool</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Google Font for a modern look -->
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary-color: #007bff;
      --primary-color-hover: #0056b3;
      --bg-color: #f4f4f4;
      --container-bg: #ffffff;
      --border-color: #ccc;
      --border-radius: 5px;
      --input-padding: 10px;
      --max-container-width: 900px;
      --font-color: #333;
    }
    body {
      font-family: 'Roboto', sans-serif;
      background-color: var(--bg-color);
      margin: 0;
      padding: 20px;
      color: var(--font-color);
    }
    .container {
      max-width: var(--max-container-width);
      margin: 0 auto;
      background: var(--container-bg);
      padding: 30px;
      box-shadow: 0 0 15px rgba(0,0,0,0.1);
      border-radius: var(--border-radius);
    }
    h1, h2, h3 {
      text-align: center;
      margin-bottom: 15px;
    }
    .item-section {
      margin-bottom: 20px;
      padding: 15px;
      background: #fafafa;
      border: 1px solid #eee;
      border-radius: var(--border-radius);
    }
    .number-input {
      display: flex;
      align-items: center;
      margin-bottom: 15px;
    }
    .number-input button {
      background-color: var(--primary-color);
      border: none;
      color: #fff;
      width: 30px;
      height: 30px;
      font-size: 1.2em;
      cursor: pointer;
      border-radius: var(--border-radius);
      transition: background 0.3s;
    }
    .number-input button:hover {
      background-color: var(--primary-color-hover);
    }
    .number-input input {
      text-align: center;
      width: 80px;
      margin: 0 5px;
      padding: 5px;
      border: 1px solid var(--border-color);
      border-radius: var(--border-radius);
    }
    label {
      font-weight: 500;
      display: block;
      margin-bottom: 5px;
    }
    input[type="text"],
    input[type="date"],
    input[type="number"],
    select,
    textarea {
      width: 100%;
      padding: var(--input-padding);
      margin-top: 5px;
      margin-bottom: 15px;
      border: 1px solid var(--border-color);
      border-radius: var(--border-radius);
      font-size: 1em;
      box-sizing: border-box;
    }
    input[type="radio"] {
      margin-right: 5px;
    }
    button {
      background-color: var(--primary-color);
      color: #fff;
      border: none;
      padding: 12px 20px;
      border-radius: var(--border-radius);
      cursor: pointer;
      font-size: 1em;
      transition: background-color 0.3s ease;
      display: block;
      margin: 20px auto;
    }
    button:hover {
      background-color: var(--primary-color-hover);
    }
    #final_score_display {
      text-align: center;
      font-weight: bold;
      font-size: 1.2em;
      margin-top: 20px;
    }
    @media (max-width: 600px) {
      .container {
        padding: 20px;
      }
      input, select, textarea, button {
        font-size: 0.9em;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>CQI Assessment Tool</h1>
    <form method="post" action="/submit_assessment" id="assessmentForm">
      <!-- Project Information -->
      <h2>Project Information</h2>
      <div class="item-section">
        <label>Project Name:</label>
        <input type="text" name="project_name">
      </div>
      <div class="item-section">
        <label>Battalion:</label>
        <select name="battalion">
          <option value="NMCB ONE">NMCB ONE</option>
          <option value="NMCB THREE">NMCB THREE</option>
          <option value="NMCB FOUR">NMCB FOUR</option>
          <option value="NMCB FIVE">NMCB FIVE</option>
          <option value="NMCB ELEVEN">NMCB ELEVEN</option>
          <option value="NMCB ONE THIRTY THREE">NMCB ONE THIRTY THREE</option>
        </select>
      </div>
      <div class="item-section">
        <label>OIC:</label>
        <input type="text" name="oic_name">
      </div>
      <div class="item-section">
        <label>AOIC:</label>
        <input type="text" name="aoic_name">
      </div>
      <div class="item-section">
        <label>Start Date:</label>
        <input type="date" name="start_date">
      </div>
      <div class="item-section">
        <label>Planned Start Date:</label>
        <input type="date" name="planned_start">
      </div>
      <div class="item-section">
        <label>Planned Completion Date:</label>
        <input type="date" name="planned_completion">
      </div>
      
      <!-- Items 1-29 -->
      <!-- Item 1 -->
      <div class="item-section">
        <h3>Item 1 – Self Assessment</h3>
        <p>(Yes = 2 pts, No = 0 pts, N/A = deduct 2 pts)</p>
        <label><input type="radio" name="item1" value="2"> Yes</label>
        <label><input type="radio" name="item1" value="0"> No</label>
        <label><input type="radio" name="item1" value="-2"> N/A</label>
        <label>Comment (required if N/A):</label>
        <textarea name="comment_item1"></textarea>
      </div>
      <!-- Item 2 -->
      <div class="item-section">
        <h3>Item 2 – Self Assessment Submission</h3>
        <p>(Yes = 2 pts, No = 0 pts, N/A = deduct 2 pts)</p>
        <label><input type="radio" name="item2" value="2"> Yes</label>
        <label><input type="radio" name="item2" value="0"> No</label>
        <label><input type="radio" name="item2" value="-2"> N/A</label>
        <label>Comment (required if N/A):</label>
        <textarea name="comment_item2"></textarea>
      </div>
      <!-- Item 3 -->
      <div class="item-section">
        <h3>Item 3 – Notice to Proceed (NTP)</h3>
        <p>(Yes = 4 pts, No = 0 pts, N/A = deduct 4 pts)</p>
        <label><input type="radio" name="item3" value="4"> Yes</label>
        <label><input type="radio" name="item3" value="0"> No</label>
        <label><input type="radio" name="item3" value="-4"> N/A</label>
        <label>Comment (required if N/A):</label>
        <textarea name="comment_item3"></textarea>
      </div>
      <!-- Item 4 – Dynamic Calculation -->
      <div class="item-section" id="item4_section">
        <h3>Item 4 – Project Schedule (Dynamic Calculation)</h3>
        <p>(Exact = 16 pts; Within deviation = 12 pts; Outside deviation = 4 pts; Not monitored = 0 pts; N/A = deduct 16 pts)</p>
        <p>
          <label><input type="radio" name="item4_option" value="calc" id="item4_calc_option" checked> Use Calculation</label>
          <label><input type="radio" name="item4_option" value="-16" id="item4_na_option"> N/A</label>
        </p>
        <div id="item4_calc_div">
          <label>Total Project Mandays:</label>
          <div class="number-input">
            <button type="button" onclick="decrement('total_md')">–</button>
            <input type="number" id="total_md" name="total_md" value="1000" step="1" oninput="calculateItem4Score()">
            <button type="button" onclick="increment('total_md')">+</button>
          </div>
          <label>Planned Work-in-Place (%):</label>
          <div class="number-input">
            <button type="button" onclick="decrement('planned_wip')">–</button>
            <input type="number" id="planned_wip" name="planned_wip" value="100" step="1" oninput="calculateItem4Score()">
            <button type="button" onclick="increment('planned_wip')">+</button>
          </div>
          <label>Actual Work-in-Place (%):</label>
          <div class="number-input">
            <button type="button" onclick="decrement('actual_wip')">–</button>
            <input type="number" id="actual_wip" name="actual_wip" value="100" step="1" oninput="calculateItem4Score()">
            <button type="button" onclick="increment('actual_wip')">+</button>
          </div>
          <p id="item4_score_display">Calculated Score for Item 4: 16</p>
          <input type="hidden" id="item4_score" name="item4_score" value="16">
        </div>
        <label>Comment (required if N/A or score not perfect):</label>
        <textarea id="comment_item4" name="comment_item4"></textarea>
      </div>
      <!-- Item 5 -->
      <div class="item-section">
        <h3>Item 5 – Project Management</h3>
        <p>(Yes = 2 pts, No = 0 pts, N/A = deduct 2 pts)</p>
        <label><input type="radio" name="item5" value="2"> Yes</label>
        <label><input type="radio" name="item5" value="0"> No</label>
        <label><input type="radio" name="item5" value="-2"> N/A</label>
        <label>Comment (required if N/A):</label>
        <textarea name="comment_item5"></textarea>
      </div>
      <!-- Item 6 – QA for 30 NCR Detail Sites -->
      <div class="item-section">
        <h3>Item 6 – QA for 30 NCR Detail Sites</h3>
        <p>(4 pts = Zero discrepancies; 3 pts = Acceptable; 2 pts = Multiple discrepancies; 0 pts = No QA involvement; N/A = deduct 4 pts)</p>
        <select name="item6">
          <option value="4">4</option>
          <option value="3">3</option>
          <option value="2">2</option>
          <option value="0">0</option>
          <option value="-4">N/A</option>
        </select>
        <label>Comment (required if N/A):</label>
        <textarea name="comment_item6"></textarea>
      </div>
      <!-- Item 7 & 8 – FAR/RFI -->
      <div class="item-section">
        <h3>Item 7 &amp; 8 – FAR/RFI</h3>
        <p>(4 pts = 100% logged; 3 pts = Acceptable; 2 pts = Missing; 0 pts = Not tracked; N/A = deduct 4 pts)</p>
        <select name="item78">
          <option value="4">4</option>
          <option value="3">3</option>
          <option value="2">2</option>
          <option value="0">0</option>
          <option value="-4">N/A</option>
        </select>
        <label>Comment (required if N/A):</label>
        <textarea name="comment_item78"></textarea>
      </div>
      <!-- Item 9 – DFOW Sheet -->
      <div class="item-section">
        <h3>Item 9 – DFOW Sheet</h3>
        <p>(4 pts = Accurate; 3 pts = Acceptable; 2 pts = Incorrect; 0 pts = Blank; N/A = deduct 4 pts)</p>
        <select name="item9">
          <option value="4">4</option>
          <option value="3">3</option>
          <option value="2">2</option>
          <option value="0">0</option>
          <option value="-4">N/A</option>
        </select>
        <label>Comment (required if N/A):</label>
        <textarea name="comment_item9"></textarea>
      </div>
      <!-- Item 10 – Turnover Projects -->
      <div class="item-section">
        <h3>Item 10 – Turnover Projects</h3>
        <p>(4 pts = Validated discrepancies with rework plan; 0 pts = No documentation; N/A = deduct 4 pts)</p>
        <select name="item10">
          <option value="4">4</option>
          <option value="0">0</option>
          <option value="-4">N/A</option>
        </select>
        <label>Comment (required if N/A):</label>
        <textarea name="comment_item10"></textarea>
      </div>
      <!-- Item 11 – Funds Provided -->
      <div class="item-section">
        <h3>Item 11 – Funds Provided</h3>
        <p>(Yes = 4 pts, No = 0 pts, N/A = deduct 4 pts)</p>
        <label><input type="radio" name="item11" value="4"> Yes</label>
        <label><input type="radio" name="item11" value="0"> No</label>
        <label><input type="radio" name="item11" value="-4"> N/A</label>
        <label>Comment (required if N/A):</label>
        <textarea name="comment_item11"></textarea>
      </div>
      <!-- Item 12 – Estimate at Completion Cost (EAC) -->
      <div class="item-section">
        <h3>Item 12 – Estimate at Completion Cost (EAC)</h3>
        <p>(4 pts = Accurate; 3 pts = Acceptable; 2 pts = Low accuracy; 0 pts = ≤59% accuracy; N/A = deduct 4 pts)</p>
        <select name="item12">
          <option value="4">4</option>
          <option value="3">3</option>
          <option value="2">2</option>
          <option value="0">0</option>
          <option value="-4">N/A</option>
        </select>
        <label>Comment (required if N/A):</label>
        <textarea name="comment_item12"></textarea>
      </div>
      <!-- Item 13 – Current Expenditures -->
      <div class="item-section">
        <h3>Item 13 – Current Expenditures</h3>
        <p>(4 pts = Accurate; 3 pts = Acceptable; 2 pts = Discrepancies; 0 pts = ≤59% accuracy; N/A = deduct 4 pts)</p>
        <select name="item13">
          <option value="4">4</option>
          <option value="3">3</option>
          <option value="2">2</option>
          <option value="0">0</option>
          <option value="-4">N/A</option>
        </select>
        <label>Comment (required if N/A):</label>
        <textarea name="comment_item13"></textarea>
      </div>
      <!-- Item 14 – Project Material Status Report (PMSR) -->
      <div class="item-section">
        <h3>Item 14 – Project Material Status Report (PMSR)</h3>
        <p>(10 pts = 100% valid; 8 pts = Acceptable; 4 pts = Discrepancies; 2/0 pts otherwise; N/A = deduct 10 pts)</p>
        <select name="item14">
          <option value="10">10</option>
          <option value="8">8</option>
          <option value="4">4</option>
          <option value="2">2</option>
          <option value="0">0</option>
          <option value="-10">N/A</option>
        </select>
        <label>Comment (required if N/A):</label>
        <textarea name="comment_item14"></textarea>
      </div>
      <!-- Item 15 – Report Submission -->
      <div class="item-section">
        <h3>Item 15 – Report Submission</h3>
        <p>(Yes = 2 pts, No = 0 pts, N/A = deduct 2 pts)</p>
        <label><input type="radio" name="item15" value="2"> Yes</label>
        <label><input type="radio" name="item15" value="0"> No</label>
        <label><input type="radio" name="item15" value="-2"> N/A</label>
        <label>Comment (required if N/A):</label>
        <textarea name="comment_item15"></textarea>
      </div>
      <!-- Item 16 – Materials On-Hand -->
      <div class="item-section">
        <h3>Item 16 – Materials On-Hand</h3>
        <p>(10 pts = Organized; 8 pts = Minor issues; 4 pts = Multiple issues; 0 pts = Unsatisfactory; N/A = deduct 10 pts)</p>
        <select name="item16">
          <option value="10">10</option>
          <option value="8">8</option>
          <option value="4">4</option>
          <option value="0">0</option>
          <option value="-10">N/A</option>
        </select>
        <label>Comment (required if N/A):</label>
        <textarea name="comment_item16"></textarea>
      </div>
      <!-- Item 17 – DD Form 200 -->
      <div class="item-section">
        <h3>Item 17 – DD Form 200</h3>
        <p>(Yes = 2 pts, No = 0 pts, N/A = deduct 2 pts)</p>
        <label><input type="radio" name="item17" value="2"> Yes</label>
        <label><input type="radio" name="item17" value="0"> No</label>
        <label><input type="radio" name="item17" value="-2"> N/A</label>
        <label>Comment (required if N/A):</label>
        <textarea name="comment_item17"></textarea>
      </div>
      <!-- Item 18 – Borrowed Material Tickler File -->
      <div class="item-section">
        <h3>Item 18 – Borrowed Material Tickler File</h3>
        <p>(Yes = 2 pts, No = 0 pts, N/A = deduct 2 pts)</p>
        <label><input type="radio" name="item18" value="2"> Yes</label>
        <label><input type="radio" name="item18" value="0"> No</label>
        <label><input type="radio" name="item18" value="-2"> N/A</label>
        <label>Comment (required if N/A):</label>
        <textarea name="comment_item18"></textarea>
      </div>
      <!-- Item 19 – Project Brief -->
      <div class="item-section">
        <h3>Item 19 – Project Brief</h3>
        <p>(5 pts = Detailed; 3 pts = Acceptable; 2 pts or 0 pts otherwise; N/A = deduct 5 pts)</p>
        <select name="item19">
          <option value="5">5</option>
          <option value="3">3</option>
          <option value="2">2</option>
          <option value="0">0</option>
          <option value="-5">N/A</option>
        </select>
        <label>Comment (required if N/A):</label>
        <textarea name="comment_item19"></textarea>
      </div>
      <!-- Item 20 – Calculate Manday Capability -->
      <div class="item-section">
        <h3>Item 20 – Calculate Manday Capability</h3>
        <p>(6 pts = Matches; 4/2/0 pts otherwise; N/A = deduct 6 pts)</p>
        <select name="item20">
          <option value="6">6</option>
          <option value="4">4</option>
          <option value="2">2</option>
          <option value="0">0</option>
          <option value="-6">N/A</option>
        </select>
        <label>Comment (required if N/A):</label>
        <textarea name="comment_item20"></textarea>
      </div>
      <!-- Item 21 – Equipment -->
      <div class="item-section">
        <h3>Item 21 – Equipment</h3>
        <p>(6 pts = All onsite; 4 pts = Acceptable; 2 pts = Partial; 0 pts = None; N/A = deduct 6 pts)</p>
        <select name="item21">
          <option value="6">6</option>
          <option value="4">4</option>
          <option value="2">2</option>
          <option value="0">0</option>
          <option value="-6">N/A</option>
        </select>
        <label>Comment (required if N/A):</label>
        <textarea name="comment_item21"></textarea>
      </div>
      <!-- Item 22 – CASS Spot Check -->
      <div class="item-section">
        <h3>Item 22 – CASS Spot Check</h3>
        <p>(12 pts = 100% compliant; 8/4/0 pts otherwise; N/A = deduct 12 pts)</p>
        <select name="item22">
          <option value="12">12</option>
          <option value="8">8</option>
          <option value="4">4</option>
          <option value="0">0</option>
          <option value="-12">N/A</option>
        </select>
        <label>Comment (required if N/A):</label>
        <textarea name="comment_item22"></textarea>
      </div>
      <!-- Item 23 – Designation Letters -->
      <div class="item-section">
        <h3>Item 23 – Designation Letters</h3>
        <p>(5 pts = Current; 3 pts = Not up-to-date; 0 pts = Missing; N/A = deduct 5 pts)</p>
        <select name="item23">
          <option value="5">5</option>
          <option value="3">3</option>
          <option value="0">0</option>
          <option value="-5">N/A</option>
        </select>
        <label>Comment (required if N/A):</label>
        <textarea name="comment_item23"></textarea>
      </div>
      <!-- Item 24 – Job Box Review -->
      <div class="item-section">
        <h3>Item 24 – Job Box Review</h3>
        <p>(20 pts maximum; deductions apply; N/A = deduct 20 pts)</p>
        <select name="item24" id="item24_select">
          <option value="20">20</option>
          <option value="0">0</option>
          <option value="-20">N/A</option>
        </select>
        <label>Deduction:</label>
        <input type="number" name="deduction24" id="deduction24" value="0" min="0" max="20">
        <label>Comment (required if N/A):</label>
        <textarea name="comment_item24"></textarea>
      </div>
      <!-- Item 25 – Review QC Package -->
      <div class="item-section">
        <h3>Item 25 – Review QC Package</h3>
        <p>(8 pts = Comprehensive; 6/4/0 pts otherwise; N/A = deduct 8 pts)</p>
        <select name="item25">
          <option value="8">8</option>
          <option value="6">6</option>
          <option value="4">4</option>
          <option value="0">0</option>
          <option value="-8">N/A</option>
        </select>
        <label>Comment (required if N/A):</label>
        <textarea name="comment_item25"></textarea>
      </div>
      <!-- Item 26 – Submittals -->
      <div class="item-section">
        <h3>Item 26 – Submittals</h3>
        <p>(4 pts = Current; 2 pts = Not current; 0 pts = Not submitted; N/A = deduct 4 pts)</p>
        <select name="item26">
          <option value="4">4</option>
          <option value="2">2</option>
          <option value="0">0</option>
          <option value="-4">N/A</option>
        </select>
        <label>Comment (required if N/A):</label>
        <textarea name="comment_item26"></textarea>
      </div>
      <!-- Item 27a – QC Inspection Plan -->
      <div class="item-section">
        <h3>Item 27a – QC Inspection Plan</h3>
        <p>(10 pts = 100% quantifiable; 7/3/0 pts otherwise; N/A = deduct 10 pts)</p>
        <select name="item27a">
          <option value="10">10</option>
          <option value="8">8</option>
          <option value="6">6</option>
          <option value="0">0</option>
          <option value="-10">N/A</option>
        </select>
        <label>Comment (required if N/A):</label>
        <textarea name="comment_item27a"></textarea>
      </div>
      <!-- Item 27b – QC Inspection -->
      <div class="item-section">
        <h3>Item 27b – QC Inspection</h3>
        <p>(5 pts = No discrepancies; 0 pts otherwise; N/A = deduct 5 pts)</p>
        <select name="item27b">
          <option value="5">5</option>
          <option value="0">0</option>
          <option value="-5">N/A</option>
        </select>
        <label>Comment (required if N/A):</label>
        <textarea name="comment_item27b"></textarea>
      </div>
      <!-- Item 28 – Job Box Review (QC) -->
      <div class="item-section" id="item28_section">
        <h3>Item 28 – Job Box Review (QC)</h3>
        <p>(Maximum 5 pts; deductions apply; N/A = deduct 5 pts)</p>
        <label><input type="radio" name="item28_option" value="5" checked> Applicable</label>
        <label><input type="radio" name="item28_option" value="-5"> N/A</label>
        <div id="item28_input_div">
          <label>Deduction:</label>
          <input type="number" name="deduction28" id="deduction28" value="0" min="0" max="5">
        </div>
        <label>Comment (required if N/A):</label>
        <textarea name="comment_item28"></textarea>
      </div>
      <!-- Item 29 – Job Box Review (Safety) -->
      <div class="item-section" id="item29_section">
        <h3>Item 29 – Job Box Review (Safety)</h3>
        <p>(Maximum 5 pts; deductions apply; N/A = deduct 5 pts)</p>
        <label><input type="radio" name="item29_option" value="5" checked> Applicable</label>
        <label><input type="radio" name="item29_option" value="-5"> N/A</label>
        <div id="item29_input_div">
          <label>Deduction:</label>
          <input type="number" name="deduction29" id="deduction29" value="0" min="0" max="5">
        </div>
        <label>Comment (required if N/A):</label>
        <textarea name="comment_item29"></textarea>
      </div>
      
      <!-- Hidden input for final score -->
      <input type="hidden" name="final_score" id="final_score_input">
      <button type="submit">Submit Assessment</button>
    </form>
    <button type="button" onclick="calculateFinalScore()">Calculate Final Score</button>
    <div id="final_score_display"></div>
  </div>
  <script>
    function decrement(id) {
      var input = document.getElementById(id);
      input.value = parseInt(input.value) - 1;
      input.dispatchEvent(new Event('input'));
    }
    function increment(id) {
      var input = document.getElementById(id);
      input.value = parseInt(input.value) + 1;
      input.dispatchEvent(new Event('input'));
    }
    function calculateItem4Score() {
      var total_md = parseFloat(document.getElementById('total_md').value);
      var planned_wip = parseFloat(document.getElementById('planned_wip').value);
      var actual_wip = parseFloat(document.getElementById('actual_wip').value);
      var calcScore = 16; // Default for exact match
      if(total_md && planned_wip && actual_wip){
         var deviation = Math.abs(planned_wip - actual_wip);
         if(deviation === 0) {
           calcScore = 16;
         } else if(deviation <= 10) {
           calcScore = 12;
         } else {
           calcScore = 4;
         }
      }
      document.getElementById('item4_score_display').innerText = "Calculated Score for Item 4: " + calcScore;
      document.getElementById('item4_score').value = calcScore;
    }
    function calculateFinalScore() {
      var total = 0;
      function getRadioValue(name) {
        var radio = document.querySelector('input[name="'+name+'"]:checked');
        return radio ? parseFloat(radio.value) : 0;
      }
      function getSelectValue(name) {
        var select = document.querySelector('select[name="'+name+'"]');
        return select ? parseFloat(select.value) : 0;
      }
      function getHiddenValue(id) {
        var elem = document.getElementById(id);
        return elem ? parseFloat(elem.value) : 0;
      }
      // Radio button items
      total += getRadioValue("item1");
      total += getRadioValue("item2");
      total += getRadioValue("item3");
      // For Item 4, use the calculated score or N/A option
      var item4Option = document.querySelector('input[name="item4_option"]:checked').value;
      if(item4Option === "calc") {
        total += getHiddenValue("item4_score");
      } else {
        total += parseFloat(item4Option);
      }
      total += getRadioValue("item5");
      // Select items
      total += getSelectValue("item6");
      total += getSelectValue("item78");
      total += getSelectValue("item9");
      total += getSelectValue("item10");
      total += getRadioValue("item11");
      total += getSelectValue("item12");
      total += getSelectValue("item13");
      total += getSelectValue("item14");
      total += getRadioValue("item15");
      total += getSelectValue("item16");
      total += getRadioValue("item17");
      total += getRadioValue("item18");
      total += getSelectValue("item19");
      total += getSelectValue("item20");
      total += getSelectValue("item21");
      total += getSelectValue("item22");
      total += getSelectValue("item23");
      total += getSelectValue("item24");
      // Apply manual deduction for Item 24
      total -= parseFloat(document.getElementById('deduction24').value || 0);
      total += getSelectValue("item25");
      total += getSelectValue("item26");
      total += getSelectValue("item27a");
      total += getSelectValue("item27b");
      // Items 28 and 29 (radio buttons with extra deductions)
      total += getRadioValue("item28_option");
      total -= parseFloat(document.getElementById('deduction28').value || 0);
      total += getRadioValue("item29_option");
      total -= parseFloat(document.getElementById('deduction29').value || 0);
      
      document.getElementById('final_score_input').value = total;
      document.getElementById('final_score_display').innerText = "Final Score: " + total;
    }
  </script>


  <style>
    /* ---------- PDF Modal Styles ---------- */
    .pdf-ref-icon {
      position: fixed;
      bottom: 20px;
      left: 20px;
      background: var(--primary-color, #007bff);
      color: #fff;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      text-align: center;
      line-height: 50px;
      cursor: pointer;
      z-index: 1000;
      box-shadow: 0 0 10px rgba(0,0,0,0.3);
      transition: background 0.3s;
    }
    .pdf-ref-icon:hover {
      background: #0056b3;
    }
    .pdf-ref-modal {
      display: none;
      position: fixed;
      z-index: 1001;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0,0,0,0.4);
    }
    .pdf-ref-content {
      background-color: #fff;
      margin: 5% auto;
      padding: 20px;
      border: 1px solid #888;
      width: 90%;
      max-width: 800px;
      border-radius: 5px;
      text-align: center;
    }
    .pdf-ref-close {
      color: #aaa;
      float: right;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
      transition: color 0.3s;
    }
    .pdf-ref-close:hover,
    .pdf-ref-close:focus {
      color: black;
      text-decoration: none;
    }

    /* ---------- Manday Modal Styles ---------- */
    .manday-icon {
      position: fixed;
      bottom: 90px; /* Adjust to appear above the PDF icon */
      right: 20px;
      background: var(--primary-color, #007bff);
      color: #fff;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      text-align: center;
      line-height: 50px;
      cursor: pointer;
      z-index: 1001;
      box-shadow: 0 0 10px rgba(0,0,0,0.3);
      transition: background 0.3s;
    }
    .manday-icon:hover {
      background: #0056b3;
    }
    .manday-modal {
      display: none;
      position: fixed;
      z-index: 1002;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0,0,0,0.4);
    }
    .manday-content {
      background-color: #fff;
      margin: 10% auto;
      padding: 20px;
      border: 1px solid #888;
      width: 90%;
      max-width: 400px;
      border-radius: 5px;
      text-align: center;
    }
    .manday-close {
      color: #aaa;
      float: right;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
      transition: color 0.3s;
    }
    .manday-close:hover,
    .manday-close:focus {
      color: black;
      text-decoration: none;
    }
    .manday-content input[type="number"] {
      width: 90%;
      padding: 5px;
      margin: 5px 0 15px;
      border: 1px solid #ccc;
      border-radius: 5px;
      font-size: 1em;
    }

    /* ---------- Calculator Modal Styles ---------- */
    .calc-icon {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: var(--primary-color, #007bff);
      color: #fff;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      text-align: center;
      line-height: 50px;
      cursor: pointer;
      z-index: 1000;
      box-shadow: 0 0 10px rgba(0,0,0,0.3);
      transition: background 0.3s;
    }
    .calc-icon:hover {
      background: #0056b3;
    }
    .calc-modal {
      display: none;
      position: fixed;
      z-index: 1001;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0,0,0,0.4);
    }
    .calc-content {
      background-color: #fff;
      margin: 15% auto;
      padding: 20px;
      border: 1px solid #888;
      width: 90%;
      max-width: 400px;
      border-radius: 5px;
      text-align: center;
    }
    .calc-close {
      color: #aaa;
      float: right;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
      transition: color 0.3s;
    }
    .calc-close:hover,
    .calc-close:focus {
      color: black;
      text-decoration: none;
    }
    .calc-buttons {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
      margin-top: 10px;
    }
    .calc-btn {
      padding: 15px;
      font-size: 1.2em;
      cursor: pointer;
      border: 1px solid #ccc;
      background: #808080;
      border-radius: 5px;
      transition: background 0.3s;
    }
    .calc-btn:hover {
      background: #a0a0a0;
    }
    @media (max-width: 600px) {
      .calc-content {
        width: 80%;
        margin: 20% auto;
      }
    }
  </style>
</head>
<body>

<!-- PDF Modal Trigger (Icon as Link) -->
<div id="pdf-ref-icon" class="pdf-ref-icon">PDF</div>

<!-- PDF Modal Structure -->
<div id="pdf-ref-modal" class="pdf-ref-modal">
  <div class="pdf-ref-content">
    <span id="pdf-ref-close" class="pdf-ref-close">&times;</span>
    <h2>PDF Reference Document</h2>
    <!-- Updated iframe to load external PDF -->
    <iframe src="https://www.marines.mil/portals/1/mcrp%203-17.7f%20z.pdf" width="100%" height="500px" style="border: none;"></iframe>
  </div>
</div>


  <!-- ---------- Manday Modal ---------- -->
  <!-- Manday Capability Modal Trigger -->
  <div id="manday-icon" class="manday-icon">MC</div>
  <!-- Manday Capability Modal Structure -->
  <div id="manday-modal" class="manday-modal">
    <div class="manday-content">
      <span id="manday-close" class="manday-close">&times;</span>
      <h2>Manday Capability Calculator</h2>
      <p>Calculate MD Capability: MC = DL × WD × ME × AF</p>
      <label for="dl_input">Direct Labor (DL):</label>
      <input type="number" id="dl_input" placeholder="Enter DL" step="1" min="0">
      
      <label for="wd_input">Available Workdays (WD):</label>
      <input type="number" id="wd_input" placeholder="Enter WD" step="1" min="0">
      
      <label for="me_input">Man-day Equivalent (ME):</label>
      <input type="number" id="me_input" placeholder="Enter ME" step="0.1" min="0">
      
      <label for="af_input">Availability Factor (AF):</label>
      <input type="number" id="af_input" placeholder="Enter AF (0-1)" step="0.01" min="0" max="1">
      
      <button id="manday-calc-button">Calculate MD Capability</button>
      <p id="manday-result">Result: </p>
    </div>
  </div>

  <!-- ---------- Calculator Modal ---------- -->
  <!-- Calculator Modal Trigger -->
  <div id="calc-icon" class="calc-icon">🖩</div>
  <!-- Calculator Modal Structure -->
  <div id="calc-modal" class="calc-modal">
    <div class="calc-content">
      <span id="calc-close" class="calc-close">&times;</span>
      <h2>Calculator</h2>
      <input type="text" id="calc-display" placeholder="0" readonly style="width:100%; padding:10px; margin-bottom:10px; font-size:1em; text-align:right;">
      <div class="calc-buttons">
        <button class="calc-btn" data-value="7">7</button>
        <button class="calc-btn" data-value="8">8</button>
        <button class="calc-btn" data-value="9">9</button>
        <button class="calc-btn" data-value="/">/</button>
        <button class="calc-btn" data-value="4">4</button>
        <button class="calc-btn" data-value="5">5</button>
        <button class="calc-btn" data-value="6">6</button>
        <button class="calc-btn" data-value="*">*</button>
        <button class="calc-btn" data-value="1">1</button>
        <button class="calc-btn" data-value="2">2</button>
        <button class="calc-btn" data-value="3">3</button>
        <button class="calc-btn" data-value="-">-</button>
        <button class="calc-btn" data-value="0">0</button>
        <button class="calc-btn" data-value=".">.</button>
        <button class="calc-btn" data-value="%">%</button>
        <button class="calc-btn" data-value="+">+</button>
        <button class="calc-btn" id="calc-clear" style="grid-column: span 2;">C</button>
        <button class="calc-btn" id="calc-equals" style="grid-column: span 2;">=</button>
      </div>
    </div>
  </div>

  <!-- ---------- JavaScript for Modals ---------- -->
  <script>
    /* ---------- PDF Modal ---------- */
    var pdfModal = document.getElementById("pdf-ref-modal");
    var pdfIcon = document.getElementById("pdf-ref-icon");
    var pdfClose = document.getElementById("pdf-ref-close");

    pdfIcon.addEventListener("click", function() {
      pdfModal.style.display = "block";
    });
    pdfClose.addEventListener("click", function() {
      pdfModal.style.display = "none";
    });
    window.addEventListener("click", function(event) {
      if (event.target == pdfModal) {
        pdfModal.style.display = "none";
      }
    });

    /* ---------- Manday Modal ---------- */
    var mandayModal = document.getElementById("manday-modal");
    var mandayIcon = document.getElementById("manday-icon");
    var mandayClose = document.getElementById("manday-close");
    var mandayCalcButton = document.getElementById("manday-calc-button");
    var mandayResult = document.getElementById("manday-result");

    mandayIcon.addEventListener("click", function() {
      mandayModal.style.display = "block";
    });
    mandayClose.addEventListener("click", function() {
      mandayModal.style.display = "none";
    });
    window.addEventListener("click", function(event) {
      if (event.target == mandayModal) {
        mandayModal.style.display = "none";
      }
    });
    mandayCalcButton.addEventListener("click", function() {
      var dl = parseFloat(document.getElementById("dl_input").value) || 0;
      var wd = parseFloat(document.getElementById("wd_input").value) || 0;
      var me = parseFloat(document.getElementById("me_input").value) || 0;
      var af = parseFloat(document.getElementById("af_input").value) || 0;
      var capability = dl * wd * me * af;
      mandayResult.textContent = "Result: " + capability.toFixed(2) + " MDs";
    });

    /* ---------- Calculator Modal ---------- */
    var calcModal = document.getElementById("calc-modal");
    var calcIcon = document.getElementById("calc-icon");
    var calcClose = document.getElementById("calc-close");
    var calcDisplay = document.getElementById("calc-display");

    calcIcon.addEventListener("click", function() {
      calcModal.style.display = "block";
    });
    calcClose.addEventListener("click", function() {
      calcModal.style.display = "none";
      calcDisplay.value = "";
    });
    window.addEventListener("click", function(event) {
      if (event.target == calcModal) {
        calcModal.style.display = "none";
        calcDisplay.value = "";
      }
    });
    document.querySelectorAll(".calc-btn").forEach(function(button) {
      button.addEventListener("click", function() {
        if (this.id === "calc-clear" || this.id === "calc-equals") return;
        var value = this.getAttribute("data-value");
        calcDisplay.value += value;
      });
    });
    document.getElementById("calc-clear").addEventListener("click", function() {
      calcDisplay.value = "";
    });
    document.getElementById("calc-equals").addEventListener("click", function() {
      try {
        calcDisplay.value = eval(calcDisplay.value);
      } catch (error) {
        calcDisplay.value = "Error";
      }
    });
  </script>

    });
  </script>
</body>
</html>
