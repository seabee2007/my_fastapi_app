<!-- templates/index.html -->
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>CQI Assessment Tool</title>
</head>
<body>
  <h1>CQI Assessment Tool</h1>

  <!-- Display validation errors if any -->
  {% if errors %}
    <div style="color: red;">
      <ul>
        {% for error in errors %}
          <li>{{ error }}</li>
        {% endfor %}
      </ul>
    </div>
  {% endif %}

  <form method="post" action="/submit_assessment">
    <!-- Project Information -->
    <h2>Project Information</h2>
    <label>Project Name:</label>
    <input type="text" name="project_name" value="{{ form_data.project_name if form_data and form_data.project_name is defined else '' }}"><br><br>
    <label>Battalion:</label>
    <input type="text" name="battalion" value="{{ form_data.battalion if form_data and form_data.battalion is defined else '' }}"><br><br>
    <label>OIC:</label>
    <input type="text" name="oic_name" value="{{ form_data.oic_name if form_data and form_data.oic_name is defined else '' }}"><br><br>
    <label>AOIC:</label>
    <input type="text" name="aoic_name" value="{{ form_data.aoic_name if form_data and form_data.aoic_name is defined else '' }}"><br><br>
    <label>Start Date:</label>
    <input type="date" name="start_date" value="{{ form_data.start_date if form_data and form_data.start_date is defined else '' }}"><br><br>
    <label>Planned Start Date:</label>
    <input type="date" name="planned_start" value="{{ form_data.planned_start if form_data and form_data.planned_start is defined else '' }}"><br><br>
    <label>Planned Completion Date:</label>
    <input type="date" name="planned_completion" value="{{ form_data.planned_completion if form_data and form_data.planned_completion is defined else '' }}"><br><br>
    <label>Actual Completion Date:</label>
    <input type="date" name="actual_completion" value="{{ form_data.actual_completion if form_data and form_data.actual_completion is defined else '' }}"><br><br>

    <h2>Assessment Inputs</h2>

    <!-- Item 1 -->
    <h3>Item 1 – Self Assessment</h3>
    <p>Has the unit completed an initial self-assessment? (Yes = 2, No = 0)</p>
    <input type="radio" name="item1" value="Yes" {% if form_data and form_data.item1=='Yes' %}checked{% endif %}>Yes
    <input type="radio" name="item1" value="No" {% if not form_data or form_data.item1!='Yes' %}checked{% endif %}>No<br>
    <label>Comment:</label><br>
    <textarea name="comment_item1">{{ form_data.comment_item1 if form_data and form_data.comment_item1 is defined else '' }}</textarea><br><br>

    <!-- Item 2 -->
    <h3>Item 2 – Self Assessment Submission</h3>
    <p>Was the submission done 7 days prior? (Yes = 2, No = 0)</p>
    <input type="radio" name="item2" value="Yes" {% if form_data and form_data.item2=='Yes' %}checked{% endif %}>Yes
    <input type="radio" name="item2" value="No" {% if not form_data or form_data.item2!='Yes' %}checked{% endif %}>No<br>
    <label>Comment:</label><br>
    <textarea name="comment_item2">{{ form_data.comment_item2 if form_data and form_data.comment_item2 is defined else '' }}</textarea><br><br>

    <!-- Item 3 -->
    <h3>Item 3 – [Item 3 Label]</h3>
    <p>Description for Item 3? (Yes = 4, No = 0)</p>
    <input type="radio" name="item3" value="Yes" {% if form_data and form_data.item3=='Yes' %}checked{% endif %}>Yes
    <input type="radio" name="item3" value="No" {% if not form_data or form_data.item3!='Yes' %}checked{% endif %}>No<br>
    <label>Comment:</label><br>
    <textarea name="comment_item3">{{ form_data.comment_item3 if form_data and form_data.comment_item3 is defined else '' }}</textarea><br><br>

    <!-- Item 4 – Project Schedule (calculated score) -->
    <h3>Item 4 – Project Schedule (calculated score)</h3>
    <div style="border:1px solid #ccc; padding:10px; margin-bottom:10px;">
      <p style="background-color: #eef; padding: 10px;">
        Score is based on the difference between planned and actual work-in-place.<br>
        Exact = 16 pts; Within deviation = 12 pts; Outside deviation = 4 pts.
      </p>
      <label>Total Project Mandays:</label>
      <input type="number" id="total_md" name="total_md" value="1000" step="1"><br><br>
      <label>Planned Work-in-Place (%):</label>
      <input type="number" id="planned_wip" name="planned_wip" value="100" step="1"><br><br>
      <label>Actual Work-in-Place (%):</label>
      <input type="number" id="actual_wip" name="actual_wip" value="100" step="1"><br><br>
      <p id="item4_score_display">Calculated Score for Item 4: 16</p>
      <!-- Hidden field to store the calculated score -->
      <input type="hidden" id="item4_score" name="item4_score" value="16">
      <div id="item4_comment_div" style="display:none;">
        <label>Comment (if not perfect):</label><br>
        <textarea id="comment_item4" name="comment_item4">{{ form_data.comment_item4 if form_data and form_data.comment_item4 is defined else '' }}</textarea>
      </div>
    </div>

    <!-- Item 5 -->
    <h3>Item 5 – [Item 5 Label]</h3>
    <p>Description for Item 5? (Yes = 2, No = 0)</p>
    <input type="radio" name="item5" value="Yes" {% if form_data and form_data.item5=='Yes' %}checked{% endif %}>Yes
    <input type="radio" name="item5" value="No" {% if not form_data or form_data.item5!='Yes' %}checked{% endif %}>No<br>
    <label>Comment:</label><br>
    <textarea name="comment_item5">{{ form_data.comment_item5 if form_data and form_data.comment_item5 is defined else '' }}</textarea><br><br>

    <!-- Item 6 -->
    <h3>Item 6 – [Item 6 Label]</h3>
    <p>Select score for Item 6 (Perfect score = 4)</p>
    <select name="item6">
      <option value="4" {% if form_data and form_data.item6=='4' %}selected{% endif %}>4</option>
      <option value="3" {% if form_data and form_data.item6=='3' %}selected{% endif %}>3</option>
      <option value="2" {% if form_data and form_data.item6=='2' %}selected{% endif %}>2</option>
      <option value="0" {% if form_data and form_data.item6=='0' %}selected{% endif %}>0</option>
    </select><br>
    <label>Comment:</label><br>
    <textarea name="comment_item6">{{ form_data.comment_item6 if form_data and form_data.comment_item6 is defined else '' }}</textarea><br><br>

    <!-- Item 7 & 8 (Combined) -->
    <h3>Item 7 & 8 – [Combined Items Label]</h3>
    <p>Select combined score for Items 7 & 8 (Perfect score = 4)</p>
    <select name="item78">
      <option value="4" {% if form_data and form_data.item78=='4' %}selected{% endif %}>4</option>
      <option value="3" {% if form_data and form_data.item78=='3' %}selected{% endif %}>3</option>
      <option value="2" {% if form_data and form_data.item78=='2' %}selected{% endif %}>2</option>
      <option value="0" {% if form_data and form_data.item78=='0' %}selected{% endif %}>0</option>
    </select><br>
    <label>Comment:</label><br>
    <textarea name="comment_item78">{{ form_data.comment_item78 if form_data and form_data.comment_item78 is defined else '' }}</textarea><br><br>

    <!-- Item 9 -->
    <h3>Item 9 – [Item 9 Label]</h3>
    <p>Select score for Item 9 (Perfect score = 4)</p>
    <select name="item9">
      <option value="4" {% if form_data and form_data.item9=='4' %}selected{% endif %}>4</option>
      <option value="3" {% if form_data and form_data.item9=='3' %}selected{% endif %}>3</option>
      <option value="2" {% if form_data and form_data.item9=='2' %}selected{% endif %}>2</option>
      <option value="0" {% if form_data and form_data.item9=='0' %}selected{% endif %}>0</option>
    </select><br>
    <label>Comment:</label><br>
    <textarea name="comment_item9">{{ form_data.comment_item9 if form_data and form_data.comment_item9 is defined else '' }}</textarea><br><br>

    <!-- Item 10 -->
    <h3>Item 10 – [Item 10 Label]</h3>
    <p>Select score for Item 10 (Options: N/A, 4, 0; Perfect = 4)</p>
    <select name="item10">
      <option value="N/A" {% if form_data and form_data.item10=='N/A' %}selected{% endif %}>N/A</option>
      <option value="4" {% if form_data and form_data.item10=='4' %}selected{% endif %}>4</option>
      <option value="0" {% if form_data and form_data.item10=='0' %}selected{% endif %}>0</option>
    </select><br>
    <label>Comment:</label><br>
    <textarea name="comment_item10">{{ form_data.comment_item10 if form_data and form_data.comment_item10 is defined else '' }}</textarea><br><br>

    <!-- Item 11 -->
    <h3>Item 11 – [Item 11 Label]</h3>
    <p>Has Item 11 been met? (Yes = 4, No = 0)</p>
    <input type="radio" name="item11" value="Yes" {% if form_data and form_data.item11=='Yes' %}checked{% endif %}>Yes
    <input type="radio" name="item11" value="No" {% if not form_data or form_data.item11!='Yes' %}checked{% endif %}>No<br>
    <label>Comment:</label><br>
    <textarea name="comment_item11">{{ form_data.comment_item11 if form_data and form_data.comment_item11 is defined else '' }}</textarea><br><br>

    <!-- Item 12 -->
    <h3>Item 12 – [Item 12 Label]</h3>
    <p>Select score for Item 12 (Perfect score = 4)</p>
    <select name="item12">
      <option value="4" {% if form_data and form_data.item12=='4' %}selected{% endif %}>4</option>
      <option value="3" {% if form_data and form_data.item12=='3' %}selected{% endif %}>3</option>
      <option value="2" {% if form_data and form_data.item12=='2' %}selected{% endif %}>2</option>
      <option value="0" {% if form_data and form_data.item12=='0' %}selected{% endif %}>0</option>
    </select><br>
    <label>Comment:</label><br>
    <textarea name="comment_item12">{{ form_data.comment_item12 if form_data and form_data.comment_item12 is defined else '' }}</textarea><br><br>

    <!-- Item 13 -->
    <h3>Item 13 – [Item 13 Label]</h3>
    <p>Select score for Item 13 (Perfect score = 4)</p>
    <select name="item13">
      <option value="4" {% if form_data and form_data.item13=='4' %}selected{% endif %}>4</option>
      <option value="3" {% if form_data and form_data.item13=='3' %}selected{% endif %}>3</option>
      <option value="2" {% if form_data and form_data.item13=='2' %}selected{% endif %}>2</option>
      <option value="0" {% if form_data and form_data.item13=='0' %}selected{% endif %}>0</option>
    </select><br>
    <label>Comment:</label><br>
    <textarea name="comment_item13">{{ form_data.comment_item13 if form_data and form_data.comment_item13 is defined else '' }}</textarea><br><br>

    <!-- Item 14 -->
    <h3>Item 14 – [Item 14 Label]</h3>
    <p>Select score for Item 14 (Perfect score = 10)</p>
    <select name="item14">
      <option value="10" {% if form_data and form_data.item14=='10' %}selected{% endif %}>10</option>
      <option value="8" {% if form_data and form_data.item14=='8' %}selected{% endif %}>8</option>
      <option value="6" {% if form_data and form_data.item14=='6' %}selected{% endif %}>6</option>
      <option value="0" {% if form_data and form_data.item14=='0' %}selected{% endif %}>0</option>
    </select><br>
    <label>Comment:</label><br>
    <textarea name="comment_item14">{{ form_data.comment_item14 if form_data and form_data.comment_item14 is defined else '' }}</textarea><br><br>

    <!-- Item 15 -->
    <h3>Item 15 – [Item 15 Label]</h3>
    <p>Has Item 15 been met? (Yes = 2, No = 0)</p>
    <input type="radio" name="item15" value="Yes" {% if form_data and form_data.item15=='Yes' %}checked{% endif %}>Yes
    <input type="radio" name="item15" value="No" {% if not form_data or form_data.item15!='Yes' %}checked{% endif %}>No<br>
    <label>Comment:</label><br>
    <textarea name="comment_item15">{{ form_data.comment_item15 if form_data and form_data.comment_item15 is defined else '' }}</textarea><br><br>

    <!-- Item 16 -->
    <h3>Item 16 – [Item 16 Label]</h3>
    <p>Select score for Item 16 (Perfect score = 10)</p>
    <select name="item16">
      <option value="10" {% if form_data and form_data.item16=='10' %}selected{% endif %}>10</option>
      <option value="8" {% if form_data and form_data.item16=='8' %}selected{% endif %}>8</option>
      <option value="6" {% if form_data and form_data.item16=='6' %}selected{% endif %}>6</option>
      <option value="0" {% if form_data and form_data.item16=='0' %}selected{% endif %}>0</option>
    </select><br>
    <label>Comment:</label><br>
    <textarea name="comment_item16">{{ form_data.comment_item16 if form_data and form_data.comment_item16 is defined else '' }}</textarea><br><br>

    <!-- Item 17 -->
    <h3>Item 17 – [Item 17 Label]</h3>
    <p>Has Item 17 been met? (Yes = 2, No = 0)</p>
    <input type="radio" name="item17" value="Yes" {% if form_data and form_data.item17=='Yes' %}checked{% endif %}>Yes
    <input type="radio" name="item17" value="No" {% if not form_data or form_data.item17!='Yes' %}checked{% endif %}>No<br>
    <label>Comment:</label><br>
    <textarea name="comment_item17">{{ form_data.comment_item17 if form_data and form_data.comment_item17 is defined else '' }}</textarea><br><br>

    <!-- Item 18 -->
    <h3>Item 18 – [Item 18 Label]</h3>
    <p>Has Item 18 been met? (Yes = 2, No = 0)</p>
    <input type="radio" name="item18" value="Yes" {% if form_data and form_data.item18=='Yes' %}checked{% endif %}>Yes
    <input type="radio" name="item18" value="No" {% if not form_data or form_data.item18!='Yes' %}checked{% endif %}>No<br>
    <label>Comment:</label><br>
    <textarea name="comment_item18">{{ form_data.comment_item18 if form_data and form_data.comment_item18 is defined else '' }}</textarea><br><br>

    <!-- Item 19 -->
    <h3>Item 19 – [Item 19 Label]</h3>
    <p>Select score for Item 19 (Perfect score = 5)</p>
    <select name="item19">
      <option value="5" {% if form_data and form_data.item19=='5' %}selected{% endif %}>5</option>
      <option value="4" {% if form_data and form_data.item19=='4' %}selected{% endif %}>4</option>
      <option value="3" {% if form_data and form_data.item19=='3' %}selected{% endif %}>3</option>
      <option value="0" {% if form_data and form_data.item19=='0' %}selected{% endif %}>0</option>
    </select><br>
    <label>Comment:</label><br>
    <textarea name="comment_item19">{{ form_data.comment_item19 if form_data and form_data.comment_item19 is defined else '' }}</textarea><br><br>

    <!-- Item 20 -->
    <h3>Item 20 – [Item 20 Label]</h3>
    <p>Select score for Item 20 (Perfect score = 6)</p>
    <select name="item20">
      <option value="6" {% if form_data and form_data.item20=='6' %}selected{% endif %}>6</option>
      <option value="5" {% if form_data and form_data.item20=='5' %}selected{% endif %}>5</option>
      <option value="4" {% if form_data and form_data.item20=='4' %}selected{% endif %}>4</option>
      <option value="0" {% if form_data and form_data.item20=='0' %}selected{% endif %}>0</option>
    </select><br>
    <label>Comment:</label><br>
    <textarea name="comment_item20">{{ form_data.comment_item20 if form_data and form_data.comment_item20 is defined else '' }}</textarea><br><br>

    <!-- Item 21 -->
    <h3>Item 21 – [Item 21 Label]</h3>
    <p>Select score for Item 21 (Perfect score = 6)</p>
    <select name="item21">
      <option value="6" {% if form_data and form_data.item21=='6' %}selected{% endif %}>6</option>
      <option value="5" {% if form_data and form_data.item21=='5' %}selected{% endif %}>5</option>
      <option value="4" {% if form_data and form_data.item21=='4' %}selected{% endif %}>4</option>
      <option value="0" {% if form_data and form_data.item21=='0' %}selected{% endif %}>0</option>
    </select><br>
    <label>Comment:</label><br>
    <textarea name="comment_item21">{{ form_data.comment_item21 if form_data and form_data.comment_item21 is defined else '' }}</textarea><br><br>

    <!-- Item 22 -->
    <h3>Item 22 – [Item 22 Label]</h3>
    <p>Select score for Item 22 (Perfect score = 12)</p>
    <select name="item22">
      <option value="12" {% if form_data and form_data.item22=='12' %}selected{% endif %}>12</option>
      <option value="10" {% if form_data and form_data.item22=='10' %}selected{% endif %}>10</option>
      <option value="8" {% if form_data and form_data.item22=='8' %}selected{% endif %}>8</option>
      <option value="0" {% if form_data and form_data.item22=='0' %}selected{% endif %}>0</option>
    </select><br>
    <label>Comment:</label><br>
    <textarea name="comment_item22">{{ form_data.comment_item22 if form_data and form_data.comment_item22 is defined else '' }}</textarea><br><br>

    <!-- Item 23 -->
    <h3>Item 23 – [Item 23 Label]</h3>
    <p>Select score for Item 23 (Perfect score = 5)</p>
    <select name="item23">
      <option value="5" {% if form_data and form_data.item23=='5' %}selected{% endif %}>5</option>
      <option value="4" {% if form_data and form_data.item23=='4' %}selected{% endif %}>4</option>
      <option value="3" {% if form_data and form_data.item23=='3' %}selected{% endif %}>3</option>
      <option value="0" {% if form_data and form_data.item23=='0' %}selected{% endif %}>0</option>
    </select><br>
    <label>Comment:</label><br>
    <textarea name="comment_item23">{{ form_data.comment_item23 if form_data and form_data.comment_item23 is defined else '' }}</textarea><br><br>

    <!-- Item 24 -->
    <h3>Item 24 – Job Box Review</h3>
    <p>Select base score for Item 24 (Default = 20)</p>
    <select name="item24">
      <option value="20" {% if form_data and form_data.item24=='20' %}selected{% endif %}>20</option>
      <option value="0" {% if form_data and form_data.item24=='0' %}selected{% endif %}>0</option>
    </select><br>
    <label>Deduction:</label>
    <input type="number" name="deduction24" value="{{ form_data.deduction24 if form_data and form_data.deduction24 is defined else '0' }}" min="0" max="20"><br>
    <label>Comment:</label><br>
    <textarea name="comment_item24">{{ form_data.comment_item24 if form_data and form_data.comment_item24 is defined else '' }}</textarea><br><br>

    <!-- Item 25 -->
    <h3>Item 25 – [Item 25 Label]</h3>
    <p>Select score for Item 25 (Perfect score = 8)</p>
    <select name="item25">
      <option value="8" {% if form_data and form_data.item25=='8' %}selected{% endif %}>8</option>
      <option value="6" {% if form_data and form_data.item25=='6' %}selected{% endif %}>6</option>
      <option value="4" {% if form_data and form_data.item25=='4' %}selected{% endif %}>4</option>
      <option value="0" {% if form_data and form_data.item25=='0' %}selected{% endif %}>0</option>
    </select><br>
    <label>Comment:</label><br>
    <textarea name="comment_item25">{{ form_data.comment_item25 if form_data and form_data.comment_item25 is defined else '' }}</textarea><br><br>

    <!-- Item 26 -->
    <h3>Item 26 – [Item 26 Label]</h3>
    <p>Select score for Item 26 (Perfect score = 4)</p>
    <select name="item26">
      <option value="4" {% if form_data and form_data.item26=='4' %}selected{% endif %}>4</option>
      <option value="3" {% if form_data and form_data.item26=='3' %}selected{% endif %}>3</option>
      <option value="2" {% if form_data and form_data.item26=='2' %}selected{% endif %}>2</option>
      <option value="0" {% if form_data and form_data.item26=='0' %}selected{% endif %}>0</option>
    </select><br>
    <label>Comment:</label><br>
    <textarea name="comment_item26">{{ form_data.comment_item26 if form_data and form_data.comment_item26 is defined else '' }}</textarea><br><br>

    <!-- Item 27a -->
    <h3>Item 27a – [Item 27a Label]</h3>
    <p>Select score for Item 27a (Perfect score = 10)</p>
    <select name="item27a">
      <option value="10" {% if form_data and form_data.item27a=='10' %}selected{% endif %}>10</option>
      <option value="8" {% if form_data and form_data.item27a=='8' %}selected{% endif %}>8</option>
      <option value="6" {% if form_data and form_data.item27a=='6' %}selected{% endif %}>6</option>
      <option value="0" {% if form_data and form_data.item27a=='0' %}selected{% endif %}>0</option>
    </select><br>
    <label>Comment:</label><br>
    <textarea name="comment_item27a">{{ form_data.comment_item27a if form_data and form_data.comment_item27a is defined else '' }}</textarea><br><br>

    <!-- Item 27b -->
    <h3>Item 27b – [Item 27b Label]</h3>
    <p>Select score for Item 27b (Perfect score = 5)</p>
    <select name="item27b">
      <option value="5" {% if form_data and form_data.item27b=='5' %}selected{% endif %}>5</option>
      <option value="4" {% if form_data and form_data.item27b=='4' %}selected{% endif %}>4</option>
      <option value="3" {% if form_data and form_data.item27b=='3' %}selected{% endif %}>3</option>
      <option value="0" {% if form_data and form_data.item27b=='0' %}selected{% endif %}>0</option>
    </select><br>
    <label>Comment:</label><br>
    <textarea name="comment_item27b">{{ form_data.comment_item27b if form_data and form_data.comment_item27b is defined else '' }}</textarea><br><br>

    <!-- Item 28 -->
    <h3>Item 28 – [Item 28 Label]</h3>
    <p>Enter deduction for Item 28 (Max deduction = 5)</p>
    <input type="number" name="deduction28" value="{{ form_data.deduction28 if form_data and form_data.deduction28 is defined else '0' }}" min="0" max="5"><br>
    <label>Comment:</label><br>
    <textarea name="comment_item28">{{ form_data.comment_item28 if form_data and form_data.comment_item28 is defined else '' }}</textarea><br><br>

    <!-- Item 29 -->
    <h3>Item 29 – [Item 29 Label]</h3>
    <p>Enter deduction for Item 29 (Max deduction = 5)</p>
    <input type="number" name="deduction29" value="{{ form_data.deduction29 if form_data and form_data.deduction29 is defined else '0' }}" min="0" max="5"><br>
    <label>Comment:</label><br>
    <textarea name="comment_item29">{{ form_data.comment_item29 if form_data and form_data.comment_item29 is defined else '' }}</textarea><br><br>

    <button type="submit">Calculate Final Score</button>
  </form>

  <hr>
  <p>Upon submission, you will be redirected to the report page to view the full assessment and add signatures.</p>

  <script>
    function calculateItem4Score() {
      var total_md = parseFloat(document.getElementById("total_md").value) || 0;
      var planned_wip = parseFloat(document.getElementById("planned_wip").value) || 0;
      var actual_wip = parseFloat(document.getElementById("actual_wip").value) || 0;
      var allowed;
      if (total_md < 1000) {
          allowed = 10;
      } else if (total_md < 2000) {
          allowed = 5;
      } else {
          allowed = 2.5;
      }
      var diff = Math.abs(actual_wip - planned_wip);
      var score;
      if (diff === 0) {
          score = 16;
      } else if (diff <= allowed) {
          score = 12;
      } else {
          score = 4;
      }
      document.getElementById("item4_score_display").innerText = "Calculated Score for Item 4: " + score;
      document.getElementById("item4_score").value = score;
      if (score !== 16) {
          document.getElementById("item4_comment_div").style.display = "block";
      } else {
          document.getElementById("item4_comment_div").style.display = "none";
          document.getElementById("comment_item4").value = "";
      }
    }
    document.getElementById("total_md").addEventListener("input", calculateItem4Score);
    document.getElementById("planned_wip").addEventListener("input", calculateItem4Score);
    document.getElementById("actual_wip").addEventListener("input", calculateItem4Score);
  </script>
</body>
</html>
