<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>CQI Assessment Tool</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Google Font for a modern look -->
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
:root {
  --primary-color: #007bff;
  --primary-color-hover: #0056b3;
  --bg-color: #f4f4f4;
  --container-bg: #ffffff;
  --border-color: #ccc;
  --border-radius: 5px;
  --input-padding: 10px;
  --max-container-width: 900px;
  --font-color: #333;
}

body {
  font-family: 'Roboto', sans-serif;
  background-color: var(--bg-color);
  margin: 0;
  padding: 20px;
  color: var(--font-color);
}

.container {
  max-width: var(--max-container-width);
  margin: 0 auto;
  background: var(--container-bg);
  padding: 30px;
  box-shadow: 0 0 15px rgba(0,0,0,0.1);
  border-radius: var(--border-radius);
}

h1, h2, h3 {
  text-align: center;
  margin-bottom: 15px;
}

.error-messages {
  background: #fdd;
  border: 1px solid #f99;
  padding: 10px;
  margin-bottom: 20px;
  border-radius: var(--border-radius);
}

.item-section {
  margin-bottom: 20px;
  padding: 15px;
  background: #fafafa;
  border: 1px solid #eee;
  border-radius: var(--border-radius);
}

.number-input {
  display: flex;
  align-items: center;
  margin-bottom: 15px;
}

.number-input button {
  background-color: var(--primary-color);
  border: none;
  color: #fff;
  width: 30px;
  height: 30px;
  font-size: 1.2em;
  cursor: pointer;
  border-radius: var(--border-radius);
  transition: background 0.3s;
}

.number-input button:hover {
  background-color: var(--primary-color-hover);
}

.number-input input {
  text-align: center;
  width: 80px;
  margin: 0 5px;
  padding: 5px;
  border: 1px solid var(--border-color);
  border-radius: var(--border-radius);
}

label {
  font-weight: 500;
  display: block;
  margin-bottom: 5px;
}

input[type="text"],
input[type="date"],
input[type="number"],
select,
textarea {
  width: 100%;
  padding: var(--input-padding);
  margin-top: 5px;
  margin-bottom: 15px;
  border: 1px solid var(--border-color);
  border-radius: var(--border-radius);
  font-size: 1em;
  box-sizing: border-box;
}

input[type="radio"] {
  margin-right: 5px;
}

button {
  background-color: var(--primary-color);
  color: #fff;
  border: none;
  padding: 12px 20px;
  border-radius: var(--border-radius);
  cursor: pointer;
  font-size: 1em;
  transition: background-color 0.3s ease;
  display: block;
  margin: 20px auto;
}

button:hover {
  background-color: var(--primary-color-hover);
}

#final_score_display {
  text-align: center;
  font-weight: bold;
  font-size: 1.2em;
  margin-top: 20px;
}

@media (max-width: 600px) {
  .container {
    padding: 20px;
  }
  input, select, textarea, button {
    font-size: 0.9em;
  }
}

/* ---------- PDF Modal Styles ---------- */
.pdf-ref-icon {
  position: fixed;
  bottom: 20px;
  left: 20px;
  background: var(--primary-color);
  color: #fff;
  border-radius: 50%;
  width: 50px;
  height: 50px;
  text-align: center;
  line-height: 50px;
  cursor: pointer;
  z-index: 1000;
  box-shadow: 0 0 10px rgba(0,0,0,0.3);
  transition: background 0.3s;
}
.pdf-ref-icon:hover {
  background: var(--primary-color-hover);
}
.pdf-ref-modal {
  display: none;
  position: fixed;
  z-index: 1001;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  overflow: auto;
  background-color: rgba(0,0,0,0.4);
}
.pdf-ref-content {
  background-color: #fff;
  margin: 5% auto;
  padding: 20px;
  border: 1px solid #888;
  width: 90%;
  max-width: 800px;
  border-radius: 5px;
  text-align: center;
}
.pdf-ref-close {
  color: #aaa;
  float: right;
  font-size: 28px;
  font-weight: bold;
  cursor: pointer;
  transition: color 0.3s;
}
.pdf-ref-close:hover,
.pdf-ref-close:focus {
  color: black;
  text-decoration: none;
}

/* ---------- Manday Modal Styles ---------- */
.manday-icon {
  position: fixed;
  bottom: 90px;
  right: 20px;
  background: var(--primary-color);
  color: #fff;
  border-radius: 50%;
  width: 50px;
  height: 50px;
  text-align: center;
  line-height: 50px;
  cursor: pointer;
  z-index: 1001;
  box-shadow: 0 0 10px rgba(0,0,0,0.3);
}
.manday-modal {
  display: none;
  position: fixed;
  z-index: 1002;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  overflow: auto;
  background-color: rgba(0,0,0,0.4);
}
.manday-content {
  background-color: #fff;
  margin: 10% auto;
  padding: 20px;
  border: 1px solid #888;
  width: 90%;
  max-width: 400px;
  border-radius: 5px;
  text-align: center;
}
.manday-close {
  color: #aaa;
  float: right;
  font-size: 28px;
  font-weight: bold;
  cursor: pointer;
}
.manday-close:hover,
.manday-close:focus {
  color: black;
  text-decoration: none;
}
.manday-content input[type="number"] {
  width: 90%;
  padding: 5px;
  margin: 5px 0 15px;
  border: 1px solid var(--border-color);
  border-radius: 5px;
  font-size: 1em;
}

/* ---------- Calculator Modal Styles ---------- */
.calc-icon {
  position: fixed;
  bottom: 20px;
  right: 20px;
  background: var(--primary-color);
  color: #fff;
  border-radius: 50%;
  width: 50px;
  height: 50px;
  text-align: center;
  line-height: 50px;
  cursor: pointer;
  z-index: 1000;
  box-shadow: 0 0 10px rgba(0,0,0,0.3);
}
.calc-modal {
  display: none;
  position: fixed;
  z-index: 1001;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  overflow: auto;
  background-color: rgba(0,0,0,0.4);
}
.calc-content {
  background-color: #fff;
  margin: 10% auto;
  padding: 10px;
  border: 1px solid #888;
  width: 90%;
  max-width: 400px;
  border-radius: 5px;
  position: relative;
}
.calc-close {
  color: #aaa;
  position: absolute;
  top: 5px;
  right: 10px;
  font-size: 28px;
  font-weight: bold;
  cursor: pointer;
}
.calc-close:hover,
.calc-close:focus {
  color: black;
  text-decoration: none;
}
.calculator {
  background: #1a1a1a;
  border-radius: 15px;
  box-shadow: 0px 0px 20px rgba(0, 0, 0, 0.5);
  overflow: hidden;
  animation: fadeIn 0.6s ease-in-out;
}
.display {
  background: #333;
  padding: 15px;
  border-bottom: 1px solid #444;
  color: #0f0;
  user-select: none;
  text-align: right;
  height: 60px;
}
.previous-display {
  font-size: 0.75em;
  color: #999;
}
.current-display {
  font-size: 1.5em;
}
.buttons {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  grid-gap: 1px;
}
.button {
  background: #222;
  padding: 20px;
  font-size: 1.5em;
  border: none;
  color: white;
  cursor: pointer;
  transition: background 0.3s, transform 0.2s, box-shadow 0.2s;
  position: relative;
  overflow: hidden;
}
.button:before {
  content: '';
  position: absolute;
  top: 0;
  left: -75%;
  width: 50%;
  height: 100%;
  background: rgba(255, 255, 255, 0.2);
  transform: skewX(-45deg);
  transition: left 0.5s;
  z-index: 0;
}
.button:hover:before {
  left: 125%;
}
.button:hover {
  background: #333;
  box-shadow: 0 0 10px rgba(255, 255, 255, 0.2);
}
.button:active {
  transform: scale(0.98);
}
.button.equal {
  background: #ff9500;
  color: white;
}
.button.equal:hover {
  background: #ffa726;
}
.button.zero {
  grid-column: span 3;
}
@keyframes fadeIn {
  from {
      opacity: 0;
      transform: translateY(20px);
  }
  to {
      opacity: 1;
      transform: translateY(0);
  }
}
@media (max-width: 600px) {
  .calc-content {
    width: 80%;
    margin: 20% auto;
  }
}
  </style>
</head>
<body>
  <div class="container">
    <h1>CQI Assessment Tool</h1>

    <!-- Display errors if any -->
    {% if errors %}
      <div class="error-messages">
        <ul>
          {% for error in errors %}
            <li>{{ error }}</li>
          {% endfor %}
        </ul>
      </div>
    {% endif %}

    <form method="post" action="/submit_assessment" id="assessmentForm">
      <!-- Project Information -->
      <h2>Project Information</h2>
      <div class="item-section">
        <label>Project Name:</label>
        <input type="text" name="project_name" value="{{ form_data.project_name if form_data and form_data.project_name is defined else '' }}">
      </div>
      <div class="item-section">
        <label>Battalion:</label>
        <select name="battalion">
          <option value="NMCB ONE" {% if form_data and form_data.battalion=='NMCB ONE' %}selected{% endif %}>NMCB ONE</option>
          <option value="NMCB THREE" {% if form_data and form_data.battalion=='NMCB THREE' %}selected{% endif %}>NMCB THREE</option>
          <option value="NMCB FOUR" {% if form_data and form_data.battalion=='NMCB FOUR' %}selected{% endif %}>NMCB FOUR</option>
          <option value="NMCB FIVE" {% if form_data and form_data.battalion=='NMCB FIVE' %}selected{% endif %}>NMCB FIVE</option>
          <option value="NMCB ELEVEN" {% if form_data and form_data.battalion=='NMCB ELEVEN' %}selected{% endif %}>NMCB ELEVEN</option>
          <option value="NMCB ONE THIRTY THREE" {% if form_data and form_data.battalion=='NMCB ONE THIRTY THREE' %}selected{% endif %}>NMCB ONE THIRTY THREE</option>
        </select>
      </div>
      <div class="item-section">
        <label>OIC:</label>
        <input type="text" name="oic_name" value="{{ form_data.oic_name if form_data and form_data.oic_name is defined else '' }}">
      </div>
      <div class="item-section">
        <label>AOIC:</label>
        <input type="text" name="aoic_name" value="{{ form_data.aoic_name if form_data and form_data.aoic_name is defined else '' }}">
      </div>
      <div class="item-section">
        <label>Start Date:</label>
        <input type="date" name="start_date" value="{{ form_data.start_date if form_data and form_data.start_date is defined else '' }}">
      </div>
      <div class="item-section">
        <label>Planned Start Date:</label>
        <input type="date" name="planned_start" value="{{ form_data.planned_start if form_data and form_data.planned_start is defined else '' }}">
      </div>
      <div class="item-section">
        <label>Planned Completion Date:</label>
        <input type="date" name="planned_completion" value="{{ form_data.planned_completion if form_data and form_data.planned_completion is defined else '' }}">
      </div>
      
      <!-- Items 1-29 -->
      <!-- Item 1 -->
      <div class="item-section">
        <h3>Item 1 – Self Assessment</h3>
        <p>Has the unit completed an initial self-assessment CQI checklist? Yes = 2 points or No =0 points.</p>
        <label><input type="radio" name="item1" value="2" {% if form_data and form_data.item1=='2' %}checked{% endif %}> Yes</label>
        <label><input type="radio" name="item1" value="0" {% if form_data and form_data.item1=='0' %}checked{% endif %}> No</label>
        <label><input type="radio" name="item1" value="-2" {% if form_data and form_data.item1=='-2' %}checked{% endif %}> N/A</label>
        <label>Comment (required if N/A or 0):</label>
        <textarea name="comment_item1">{{ form_data.comment_item1 if form_data and form_data.comment_item1 is defined else '' }}</textarea>
      </div>
      <!-- Item 2 -->
      <div class="item-section">
        <h3>Item 2 – Self Assessment Submission</h3>
        <p>Were the results of the self-assessment submitted to 30 NCR sharepoint no later than 7-days prior to inspection? Yes = 2 points or No =0 points.</p>
        <label><input type="radio" name="item2" value="2" {% if form_data and form_data.item2=='2' %}checked{% endif %}> Yes</label>
        <label><input type="radio" name="item2" value="0" {% if form_data and form_data.item2=='0' %}checked{% endif %}> No</label>
        <label><input type="radio" name="item2" value="-2" {% if form_data and form_data.item2=='-2' %}checked{% endif %}> N/A</label>
        <label>Comment (required if N/A or 0):</label>
        <textarea name="comment_item2">{{ form_data.comment_item2 if form_data and form_data.comment_item2 is defined else '' }}</textarea>
      </div>
      <!-- Item 3 -->
      <div class="item-section">
        <h3>Item 3 – Notice to Proceed (NTP)</h3>
        <p>Has a project confirmation or turnover brief been conducted with 30 NCR resulting in receiving a NTP? Yes = 4 points or No =0 points.</p>
        <label><input type="radio" name="item3" value="4" {% if form_data and form_data.item3=='4' %}checked{% endif %}> Yes</label>
        <label><input type="radio" name="item3" value="0" {% if form_data and form_data.item3=='0' %}checked{% endif %}> No</label>
        <label><input type="radio" name="item3" value="-4" {% if form_data and form_data.item3=='-4' %}checked{% endif %}> N/A</label>
        <label>Comment (required if N/A or less then 4):</label>
        <textarea name="comment_item3">{{ form_data.comment_item3 if form_data and form_data.comment_item3 is defined else '' }}</textarea>
      </div>
      <!-- Item 4 – Dynamic Calculation -->
      <div class="item-section" id="item4_section">
        <h3>Item 4 – Project Schedule (Dynamic Calculation)</h3>
        <p>Per NTTP 4.04.2 NCF OPS, Allowable schedule deviations are based on total project Mandays (MD):</p>
        <p> 0 - 1,000 MD = 10% +/-</p>
        <p> 1,000 – 2,000 MD = 5% +/-</p>
        <p> 2,000+ MD = 2.5% +/-</p>
        <p>(Exact = 16 pts; Within deviation = 12 pts; Outside deviation = 4 pts; Not monitored = 0 pts)</p>
        <p>
          <label><input type="radio" name="item4_option" value="calc" id="item4_calc_option" {% if not form_data or form_data.item4_option is not defined or form_data.item4_option == "calc" %}checked{% endif %}> Use Calculation</label>
          <label><input type="radio" name="item4_option" value="-16" id="item4_na_option" {% if form_data and form_data.item4_option == "-16" %}checked{% endif %}> N/A</label>
        </p>
        <div id="item4_calc_div">
          <label>Total Project Mandays:</label>
          <div class="number-input">
            <button type="button" onclick="decrement('total_md')">–</button>
            <input type="number" id="total_md" name="total_md" value="{{ form_data.total_md if form_data and form_data.total_md is defined else '1000' }}" step="1" oninput="calculateItem4Score()">
            <button type="button" onclick="increment('total_md')">+</button>
          </div>
          <label>Planned Work-in-Place (%):</label>
          <div class="number-input">
            <button type="button" onclick="decrement('planned_wip')">–</button>
            <input type="number" id="planned_wip" name="planned_wip" value="{{ form_data.planned_wip if form_data and form_data.planned_wip is defined else '100' }}" step="1" oninput="calculateItem4Score()">
            <button type="button" onclick="increment('planned_wip')">+</button>
          </div>
          <label>Actual Work-in-Place (%):</label>
          <div class="number-input">
            <button type="button" onclick="decrement('actual_wip')">–</button>
            <input type="number" id="actual_wip" name="actual_wip" value="{{ form_data.actual_wip if form_data and form_data.actual_wip is defined else '100' }}" step="1" oninput="calculateItem4Score()">
            <button type="button" onclick="increment('actual_wip')">+</button>
          </div>
          <p id="item4_score_display">Calculated Score for Item 4: <span id="calcScoreDisplay">16</span></p>
          <input type="hidden" id="item4_score" name="item4_score" value="{{ form_data.item4_score if form_data and form_data.item4_score is defined else '16' }}">
        </div>
        <label>Comment (required if N/A or score not perfect):</label>
        <textarea id="comment_item4" name="comment_item4">{{ form_data.comment_item4 if form_data and form_data.comment_item4 is defined else '' }}</textarea>
      </div>
      <!-- Item 5 -->
      <div class="item-section">
        <h3>Item 5 – Project Management</h3>
        <p>Is a project management tool/CPM being utilized to track progress and scheduling? Yes = 2 points or No =0 points.</p>
        <label><input type="radio" name="item5" value="2" {% if form_data and form_data.item5=='2' %}checked{% endif %}> Yes</label>
        <label><input type="radio" name="item5" value="0" {% if form_data and form_data.item5=='0' %}checked{% endif %}> No</label>
        <label><input type="radio" name="item5" value="-2" {% if form_data and form_data.item5=='-2' %}checked{% endif %}> N/A</label>
        <label>Comment (required if N/A):</label>
        <textarea name="comment_item5">{{ form_data.comment_item5 if form_data and form_data.comment_item5 is defined else '' }}</textarea>
      </div>
      <!-- Item 6 – QA for 30 NCR Detail Sites -->
      <div class="item-section">
        <h3>Item 6 – QA for 30 NCR Detail Sites</h3>
        <p>Validate if NAVFAC or contracted QA (if applicable) is in place and is receiving QC reports, if not, 30 NCR is the default QA agency.</p>
        <p>(4 pts = Zero discrepancies; 3 pts = Acceptable; 2 pts = Multiple discrepancies; 0 pts = No QA involvement)</p>
        <select name="item6">
          <option value="4" {% if form_data and form_data.item6=='4' %}selected{% endif %}>4</option>
          <option value="3" {% if form_data and form_data.item6=='3' %}selected{% endif %}>3</option>
          <option value="2" {% if form_data and form_data.item6=='2' %}selected{% endif %}>2</option>
          <option value="0" {% if form_data and form_data.item6=='0' %}selected{% endif %}>0</option>
          <option value="-4" {% if form_data and form_data.item6=='-4' %}selected{% endif %}>N/A</option>
        </select>
        <label>Comment (required if N/A):</label>
        <textarea name="comment_item6">{{ form_data.comment_item6 if form_data and form_data.comment_item6 is defined else '' }}</textarea>
      </div>
      <!-- Item 7 & 8 – FAR/RFI -->
      <div class="item-section">
        <h3>Item 7 &amp; 8 – FAR/RFI</h3>
        <p>Inspect FAR/RFI log and ensure continuity and no gaps for the ENTIRE life of the project.</p>
        <p>(4 pts = 100% logged; 3 pts = Acceptable; 2 pts = Missing; 0 pts = Not tracked)</p>
        <select name="item78">
          <option value="4" {% if form_data and form_data.item78=='4' %}selected{% endif %}>4</option>
          <option value="3" {% if form_data and form_data.item78=='3' %}selected{% endif %}>3</option>
          <option value="2" {% if form_data and form_data.item78=='2' %}selected{% endif %}>2</option>
          <option value="0" {% if form_data and form_data.item78=='0' %}selected{% endif %}>0</option>
          <option value="-4" {% if form_data and form_data.item78=='-4' %}selected{% endif %}>N/A</option>
        </select>
        <label>Comment (required if N/A):</label>
        <textarea name="comment_item78">{{ form_data.comment_item78 if form_data and form_data.comment_item78 is defined else '' }}</textarea>
      </div>
      <!-- Item 9 – DFOW Sheet -->
      <div class="item-section">
        <h3>Item 9 – DFOW Sheet</h3>
        <p>Ensure the initial and actual dates are entered on the DFOW sheet.</p>
        <p>(4 pts = Accurate; 3 pts = Acceptable; 2 pts = Incorrect; 0 pts = Blank)</p>
        <select name="item9">
          <option value="4" {% if form_data and form_data.item9=='4' %}selected{% endif %}>4</option>
          <option value="3" {% if form_data and form_data.item9=='3' %}selected{% endif %}>3</option>
          <option value="2" {% if form_data and form_data.item9=='2' %}selected{% endif %}>2</option>
          <option value="0" {% if form_data and form_data.item9=='0' %}selected{% endif %}>0</option>
          <option value="-4" {% if form_data and form_data.item9=='-4' %}selected{% endif %}>N/A</option>
        </select>
        <label>Comment (required if N/A):</label>
        <textarea name="comment_item9">{{ form_data.comment_item9 if form_data and form_data.comment_item9 is defined else '' }}</textarea>
      </div>
      <!-- Item 10 – Turnover Projects -->
      <div class="item-section">
        <h3>Item 10 – Turnover Projects</h3>
        <p>Inspect the project turnover memorandum. Have any discrepancies been identified and documented post turnover?</p>
        <p>(4 pts = Validated discrepancies with rework plan; 0 pts = No documentation; N/A = deduct 4 pts)</p>
        <select name="item10">
          <option value="4" {% if form_data and form_data.item10=='4' %}selected{% endif %}>4</option>
          <option value="0" {% if form_data and form_data.item10=='0' %}selected{% endif %}>0</option>
          <option value="-4" {% if form_data and form_data.item10=='-4' %}selected{% endif %}>N/A</option>
        </select>
        <label>Comment (required if N/A):</label>
        <textarea name="comment_item10">{{ form_data.comment_item10 if form_data and form_data.comment_item10 is defined else '' }}</textarea>
      </div>
      <!-- Item 11 – Funds Provided -->
      <div class="item-section">
        <h3>Item 11 – Funds Provided</h3>
        <p>Validate that project funding is being tracked via project funding documents (EG: DD1391, MIPR)</p>
        <p>(Yes = 4 pts, No = 0 pts)</p>
        <label><input type="radio" name="item11" value="4" {% if form_data and form_data.item11=='4' %}checked{% endif %}> Yes</label>
        <label><input type="radio" name="item11" value="0" {% if form_data and form_data.item11=='0' %}checked{% endif %}> No</label>
        <label><input type="radio" name="item11" value="-4" {% if form_data and form_data.item11=='-4' %}checked{% endif %}> N/A</label>
        <label>Comment (required if N/A):</label>
        <textarea name="comment_item11">{{ form_data.comment_item11 if form_data and form_data.comment_item11 is defined else '' }}</textarea>
      </div>
      <!-- Item 12 – Estimate at Completion Cost (EAC) -->
      <div class="item-section">
        <h3>Item 12 – Estimate at Completion Cost (EAC)</h3>
        <p>EAC is monitored and all figures are accurate. EAC is within 90%-100% accuracy range. = 4 points</p>
        <p>Acceptable or recommendations given to improve, EAC is within 89%-80% accuracy range. = 3 points</p>
        <p>EAC is within 79%-60% accuracy range. = 2 points</p>
        <p>EAC discrepancies are ≤59% accuracy range. = 0 points</p>
        <select name="item12">
          <option value="4" {% if form_data and form_data.item12=='4' %}selected{% endif %}>4</option>
          <option value="3" {% if form_data and form_data.item12=='3' %}selected{% endif %}>3</option>
          <option value="2" {% if form_data and form_data.item12=='2' %}selected{% endif %}>2</option>
          <option value="0" {% if form_data and form_data.item12=='0' %}selected{% endif %}>0</option>
          <option value="-4" {% if form_data and form_data.item12=='-4' %}selected{% endif %}>N/A</option>
        </select>
        <label>Comment (required if N/A):</label>
        <textarea name="comment_item12">{{ form_data.comment_item12 if form_data and form_data.comment_item12 is defined else '' }}</textarea>
      </div>
      <!-- Item 13 – Current Expenditures -->
      <div class="item-section">
        <h3>Item 13 – Current Expenditures</h3>
        <p>Expenditures are accurate. Expenditures are accounted for and project funding is within 90%-100% accuracy range. = 4 points</p>
        <p>Acceptable or recommendations given to improve. Expenditures are within 89%-80% accuracy range = 3 points</p>
        <p>Tracking of expenditures is not accurate with multiple discrepancies. Expenditures are within 79%-60% accuracy range. = 2 points</p>
        <p>Expenditure discrepancies are ≤59% accuracy range = 0 points</p>
        <select name="item13">
          <option value="4" {% if form_data and form_data.item13=='4' %}selected{% endif %}>4</option>
          <option value="3" {% if form_data and form_data.item13=='3' %}selected{% endif %}>3</option>
          <option value="2" {% if form_data and form_data.item13=='2' %}selected{% endif %}>2</option>
          <option value="0" {% if form_data and form_data.item13=='0' %}selected{% endif %}>0</option>
          <option value="-4" {% if form_data and form_data.item13=='-4' %}selected{% endif %}>N/A</option>
        </select>
        <label>Comment (required if N/A):</label>
        <textarea name="comment_item13">{{ form_data.comment_item13 if form_data and form_data.comment_item13 is defined else '' }}</textarea>
      </div>
      <!-- Item 14 – Project Material Status Report (PMSR) -->
      <div class="item-section">
        <h3>Item 14 – Project Material Status Report (PMSR)</h3>
        <p>(10 pts = 100% valid; 8 pts = Acceptable; 4 pts = Discrepancies; 2/0 pts otherwise; N/A = deduct 10 pts)</p>
        <select name="item14">
          <option value="10" {% if form_data and form_data.item14=='10' %}selected{% endif %}>10</option>
          <option value="8" {% if form_data and form_data.item14=='8' %}selected{% endif %}>8</option>
          <option value="4" {% if form_data and form_data.item14=='4' %}selected{% endif %}>4</option>
          <option value="2" {% if form_data and form_data.item14=='2' %}selected{% endif %}>2</option>
          <option value="0" {% if form_data and form_data.item14=='0' %}selected{% endif %}>0</option>
          <option value="-10" {% if form_data and form_data.item14=='-10' %}selected{% endif %}>N/A</option>
        </select>
        <label>Comment (required if N/A):</label>
        <textarea name="comment_item14">{{ form_data.comment_item14 if form_data and form_data.comment_item14 is defined else '' }}</textarea>
      </div>
      <!-- Item 15 – Report Submission -->
      <div class="item-section">
        <h3>Item 15 – Report Submission</h3>
        <p>(Yes = 2 pts, No = 0 pts, N/A = deduct 2 pts)</p>
        <label><input type="radio" name="item15" value="2" {% if form_data and form_data.item15=='2' %}checked{% endif %}> Yes</label>
        <label><input type="radio" name="item15" value="0" {% if form_data and form_data.item15=='0' %}checked{% endif %}> No</label>
        <label><input type="radio" name="item15" value="-2" {% if form_data and form_data.item15=='-2' %}checked{% endif %}> N/A</label>
        <label>Comment (required if N/A):</label>
        <textarea name="comment_item15">{{ form_data.comment_item15 if form_data and form_data.comment_item15 is defined else '' }}</textarea>
      </div>
      <!-- Item 16 – Materials On-Hand -->
      <div class="item-section">
        <h3>Item 16 – Materials On-Hand</h3>
        <p>(10 pts = Organized; 8 pts = Minor issues; 4 pts = Multiple issues; 0 pts = Unsatisfactory; N/A = deduct 10 pts)</p>
        <select name="item16">
          <option value="10" {% if form_data and form_data.item16=='10' %}selected{% endif %}>10</option>
          <option value="8" {% if form_data and form_data.item16=='8' %}selected{% endif %}>8</option>
          <option value="4" {% if form_data and form_data.item16=='4' %}selected{% endif %}>4</option>
          <option value="0" {% if form_data and form_data.item16=='0' %}selected{% endif %}>0</option>
          <option value="-10" {% if form_data and form_data.item16=='-10' %}selected{% endif %}>N/A</option>
        </select>
        <label>Comment (required if N/A):</label>
        <textarea name="comment_item16">{{ form_data.comment_item16 if form_data and form_data.comment_item16 is defined else '' }}</textarea>
      </div>
      <!-- Item 17 – DD Form 200 -->
      <div class="item-section">
        <h3>Item 17 – DD Form 200</h3>
        <p>(Yes = 2 pts, No = 0 pts, N/A = deduct 2 pts)</p>
        <label><input type="radio" name="item17" value="2" {% if form_data and form_data.item17=='2' %}checked{% endif %}> Yes</label>
        <label><input type="radio" name="item17" value="0" {% if form_data and form_data.item17=='0' %}checked{% endif %}> No</label>
        <label><input type="radio" name="item17" value="-2" {% if form_data and form_data.item17=='-2' %}checked{% endif %}> N/A</label>
        <label>Comment (required if N/A):</label>
        <textarea name="comment_item17">{{ form_data.comment_item17 if form_data and form_data.comment_item17 is defined else '' }}</textarea>
      </div>
      <!-- Item 18 – Borrowed Material Tickler File -->
      <div class="item-section">
        <h3>Item 18 – Borrowed Material Tickler File</h3>
        <p>(Yes = 2 pts, No = 0 pts, N/A = deduct 2 pts)</p>
        <label><input type="radio" name="item18" value="2" {% if form_data and form_data.item18=='2' %}checked{% endif %}> Yes</label>
        <label><input type="radio" name="item18" value="0" {% if form_data and form_data.item18=='0' %}checked{% endif %}> No</label>
        <label><input type="radio" name="item18" value="-2" {% if form_data and form_data.item18=='-2' %}checked{% endif %}> N/A</label>
        <label>Comment (required if N/A):</label>
        <textarea name="comment_item18">{{ form_data.comment_item18 if form_data and form_data.item18 is defined else '' }}</textarea>
      </div>
      <!-- Item 19 – Project Brief -->
      <div class="item-section">
        <h3>Item 19 – Project Brief</h3>
        <p>(5 pts = Detailed; 3 pts = Acceptable; 2 pts or 0 pts otherwise; N/A = deduct 5 pts)</p>
        <select name="item19">
          <option value="5" {% if form_data and form_data.item19=='5' %}selected{% endif %}>5</option>
          <option value="3" {% if form_data and form_data.item19=='3' %}selected{% endif %}>3</option>
          <option value="2" {% if form_data and form_data.item19=='2' %}selected{% endif %}>2</option>
          <option value="0" {% if form_data and form_data.item19=='0' %}selected{% endif %}>0</option>
          <option value="-5" {% if form_data and form_data.item19=='-5' %}selected{% endif %}>N/A</option>
        </select>
        <label>Comment (required if N/A):</label>
        <textarea name="comment_item19">{{ form_data.comment_item19 if form_data and form_data.comment_item19 is defined else '' }}</textarea>
      </div>
      <!-- Item 20 – Calculate Manday Capability -->
      <div class="item-section">
        <h3>Item 20 – Calculate Manday Capability</h3>
        <p>(6 pts = Matches; 4/2/0 pts otherwise; N/A = deduct 6 pts)</p>
        <select name="item20">
          <option value="6" {% if form_data and form_data.item20=='6' %}selected{% endif %}>6</option>
          <option value="4" {% if form_data and form_data.item20=='4' %}selected{% endif %}>4</option>
          <option value="2" {% if form_data and form_data.item20=='2' %}selected{% endif %}>2</option>
          <option value="0" {% if form_data and form_data.item20=='0' %}selected{% endif %}>0</option>
          <option value="-6" {% if form_data and form_data.item20=='-6' %}selected{% endif %}>N/A</option>
        </select>
        <label>Comment (required if N/A):</label>
        <textarea name="comment_item20">{{ form_data.comment_item20 if form_data and form_data.comment_item20 is defined else '' }}</textarea>
      </div>
      <!-- Item 21 – Equipment -->
      <div class="item-section">
        <h3>Item 21 – Equipment</h3>
        <p>(6 pts = All onsite; 4 pts = Acceptable; 2 pts = Partial; 0 pts = None; N/A = deduct 6 pts)</p>
        <select name="item21">
          <option value="6" {% if form_data and form_data.item21=='6' %}selected{% endif %}>6</option>
          <option value="4" {% if form_data and form_data.item21=='4' %}selected{% endif %}>4</option>
          <option value="2" {% if form_data and form_data.item21=='2' %}selected{% endif %}>2</option>
          <option value="0" {% if form_data and form_data.item21=='0' %}selected{% endif %}>0</option>
          <option value="-6" {% if form_data and form_data.item21=='-6' %}selected{% endif %}>N/A</option>
        </select>
        <label>Comment (required if N/A):</label>
        <textarea name="comment_item21">{{ form_data.comment_item21 if form_data and form_data.item21 is defined else '' }}</textarea>
      </div>
      <!-- Item 22 – CASS Spot Check -->
      <div class="item-section">
        <h3>Item 22 – CASS Spot Check</h3>
        <p>(12 pts = 100% compliant; 8/4/0 pts otherwise; N/A = deduct 12 pts)</p>
        <select name="item22">
          <option value="12" {% if form_data and form_data.item22=='12' %}selected{% endif %}>12</option>
          <option value="8" {% if form_data and form_data.item22=='8' %}selected{% endif %}>8</option>
          <option value="4" {% if form_data and form_data.item22=='4' %}selected{% endif %}>4</option>
          <option value="0" {% if form_data and form_data.item22=='0' %}selected{% endif %}>0</option>
          <option value="-12" {% if form_data and form_data.item22=='-12' %}selected{% endif %}>N/A</option>
        </select>
        <label>Comment (required if N/A):</label>
        <textarea name="comment_item22">{{ form_data.comment_item22 if form_data and form_data.comment_item22 is defined else '' }}</textarea>
      </div>
      <!-- Item 23 – Designation Letters -->
      <div class="item-section">
        <h3>Item 23 – Designation Letters</h3>
        <p>(5 pts = Current; 3 pts = Not up-to-date; 0 pts = Missing; N/A = deduct 5 pts)</p>
        <select name="item23">
          <option value="5" {% if form_data and form_data.item23=='5' %}selected{% endif %}>5</option>
          <option value="3" {% if form_data and form_data.item23=='3' %}selected{% endif %}>3</option>
          <option value="0" {% if form_data and form_data.item23=='0' %}selected{% endif %}>0</option>
          <option value="-5" {% if form_data and form_data.item23=='-5' %}selected{% endif %}>N/A</option>
        </select>
        <label>Comment (required if N/A):</label>
        <textarea name="comment_item23">{{ form_data.comment_item23 if form_data and form_data.item23 is defined else '' }}</textarea>
      </div>
      <!-- Item 24 – Job Box Review -->
      <div class="item-section" id="item24_section">
        <h3>Item 24 – Job Box Review</h3>
        <p>(20 pts maximum; deductions apply; N/A = deduct 20 pts)</p>
        <select name="item24" id="item24_select">
          <option value="20" {% if form_data and form_data.item24=='20' %}selected{% endif %}>20</option>
          <option value="0" {% if form_data and form_data.item24=='0' %}selected{% endif %}>0</option>
          <option value="-20" {% if form_data and form_data.item24=='-20' %}selected{% endif %}>N/A</option>
        </select>
        <label>Deduction:</label>
        <input type="number" name="deduction24" id="deduction24" value="{{ form_data.deduction24 if form_data and form_data.deduction24 is defined else '0' }}" min="0" max="20">
        <label>Comment (required if N/A):</label>
        <textarea name="comment_item24">{{ form_data.comment_item24 if form_data and form_data.comment_item24 is defined else '' }}</textarea>
      </div>
      <!-- Item 25 – Review QC Package -->
      <div class="item-section">
        <h3>Item 25 – Review QC Package</h3>
        <p>(8 pts = Comprehensive; 6/4/0 pts otherwise; N/A = deduct 8 pts)</p>
        <select name="item25">
          <option value="8" {% if form_data and form_data.item25=='8' %}selected{% endif %}>8</option>
          <option value="6" {% if form_data and form_data.item25=='6' %}selected{% endif %}>6</option>
          <option value="4" {% if form_data and form_data.item25=='4' %}selected{% endif %}>4</option>
          <option value="0" {% if form_data and form_data.item25=='0' %}selected{% endif %}>0</option>
          <option value="-8" {% if form_data and form_data.item25=='-8' %}selected{% endif %}>N/A</option>
        </select>
        <label>Comment (required if N/A):</label>
        <textarea name="comment_item25">{{ form_data.comment_item25 if form_data and form_data.comment_item25 is defined else '' }}</textarea>
      </div>
      <!-- Item 26 – Submittals -->
      <div class="item-section">
        <h3>Item 26 – Submittals</h3>
        <p>(4 pts = Current; 2 pts = Not current; 0 pts = Not submitted; N/A = deduct 4 pts)</p>
        <select name="item26">
          <option value="4" {% if form_data and form_data.item26=='4' %}selected{% endif %}>4</option>
          <option value="2" {% if form_data and form_data.item26=='2' %}selected{% endif %}>2</option>
          <option value="0" {% if form_data and form_data.item26=='0' %}selected{% endif %}>0</option>
          <option value="-4" {% if form_data and form_data.item26=='-4' %}selected{% endif %}>N/A</option>
        </select>
        <label>Comment (required if N/A):</label>
        <textarea name="comment_item26">{{ form_data.comment_item26 if form_data and form_data.item26 is defined else '' }}</textarea>
      </div>
      <!-- Item 27a – QC Inspection Plan -->
      <div class="item-section">
        <h3>Item 27a – QC Inspection Plan</h3>
        <p>(10 pts = 100% quantifiable; 7/3/0 pts otherwise; N/A = deduct 10 pts)</p>
        <select name="item27a">
          <option value="10" {% if form_data and form_data.item27a=='10' %}selected{% endif %}>10</option>
          <option value="8" {% if form_data and form_data.item27a=='8' %}selected{% endif %}>8</option>
          <option value="6" {% if form_data and form_data.item27a=='6' %}selected{% endif %}>6</option>
          <option value="0" {% if form_data and form_data.item27a=='0' %}selected{% endif %}>0</option>
          <option value="-10" {% if form_data and form_data.item27a=='-10' %}selected{% endif %}>N/A</option>
        </select>
        <label>Comment (required if N/A):</label>
        <textarea name="comment_item27a">{{ form_data.comment_item27a if form_data and form_data.comment_item27a is defined else '' }}</textarea>
      </div>
      <!-- Item 27b – QC Inspection -->
      <div class="item-section">
        <h3>Item 27b – QC Inspection</h3>
        <p>(5 pts = No discrepancies; 0 pts otherwise; N/A = deduct 5 pts)</p>
        <select name="item27b">
          <option value="5" {% if form_data and form_data.item27b=='5' %}selected{% endif %}>5</option>
          <option value="0" {% if form_data and form_data.item27b=='0' %}selected{% endif %}>0</option>
          <option value="-5" {% if form_data and form_data.item27b=='-5' %}selected{% endif %}>N/A</option>
        </select>
        <label>Comment (required if N/A):</label>
        <textarea name="comment_item27b">{{ form_data.comment_item27b if form_data and form_data.comment_item27b is defined else '' }}</textarea>
      </div>
      <!-- Item 28 – Job Box Review (QC) -->
      <div class="item-section" id="item28_section">
        <h3>Item 28 – Job Box Review (QC)</h3>
        <p>(Maximum 5 pts; deductions apply; N/A = deduct 5 pts)</p>
        <label><input type="radio" name="item28_option" value="5" {% if not form_data or form_data.item28_option is not defined or form_data.item28_option=='5' %}checked{% endif %}> Applicable</label>
        <label><input type="radio" name="item28_option" value="-5" {% if form_data and form_data.item28_option=='-5' %}checked{% endif %}> N/A</label>
        <div id="item28_input_div">
          <label>Deduction:</label>
          <input type="number" name="deduction28" id="deduction28" value="{{ form_data.deduction28 if form_data and form_data.deduction28 is defined else '0' }}" min="0" max="5">
        </div>
        <label>Comment (required if N/A):</label>
        <textarea name="comment_item28">{{ form_data.comment_item28 if form_data and form_data.comment_item28 is defined else '' }}</textarea>
      </div>
      <!-- Item 29 – Job Box Review (Safety) -->
      <div class="item-section" id="item29_section">
        <h3>Item 29 – Job Box Review (Safety)</h3>
        <p>(Maximum 5 pts; deductions apply; N/A = deduct 5 pts)</p>
        <label><input type="radio" name="item29_option" value="5" {% if not form_data or form_data.item29_option is not defined or form_data.item29_option=='5' %}checked{% endif %}> Applicable</label>
        <label><input type="radio" name="item29_option" value="-5" {% if form_data and form_data.item29_option=='-5' %}checked{% endif %}> N/A</label>
        <div id="item29_input_div">
          <label>Deduction:</label>
          <input type="number" name="deduction29" id="deduction29" value="{{ form_data.deduction29 if form_data and form_data.deduction29 is defined else '0' }}" min="0" max="5">
        </div>
        <label>Comment (required if N/A):</label>
        <textarea name="comment_item29">{{ form_data.comment_item29 if form_data and form_data.comment_item29 is defined else '' }}</textarea>
      </div>
      
      <!-- Hidden input for final score -->
      <input type="hidden" name="final_score" id="final_score_input">
      <button type="submit">Submit Assessment</button>
    </form>
   
  <script>
    function decrement(id) {
      var input = document.getElementById(id);
      input.value = parseInt(input.value) - 1;
      input.dispatchEvent(new Event('input'));
    }
    function increment(id) {
      var input = document.getElementById(id);
      input.value = parseInt(input.value) + 1;
      input.dispatchEvent(new Event('input'));
    }
    function calculateItem4Score() {
      var total_md = parseFloat(document.getElementById('total_md').value);
      var planned_wip = parseFloat(document.getElementById('planned_wip').value);
      var actual_wip = parseFloat(document.getElementById('actual_wip').value);
      var calcScore = 16; // Default for exact match
      if(total_md && planned_wip && actual_wip){
         var deviation = Math.abs(planned_wip - actual_wip);
         if(deviation === 0) {
           calcScore = 16;
         } else if(deviation <= 10) {
           calcScore = 12;
         } else {
           calcScore = 4;
         }
      }
      document.getElementById('item4_score_display').innerText = "Calculated Score for Item 4: " + calcScore;
      document.getElementById('item4_score').value = calcScore;
    }
    function calculateFinalScore() {
      var total = 0;
      function getRadioValue(name) {
        var radio = document.querySelector('input[name="'+name+'"]:checked');
        return radio ? parseFloat(radio.value) : 0;
      }
      function getSelectValue(name) {
        var select = document.querySelector('select[name="'+name+'"]');
        return select ? parseFloat(select.value) : 0;
      }
      function getHiddenValue(id) {
        var elem = document.getElementById(id);
        return elem ? parseFloat(elem.value) : 0;
      }
      // Radio button items
      total += getRadioValue("item1");
      total += getRadioValue("item2");
      total += getRadioValue("item3");
      // For Item 4, use the calculated score or N/A option
      var item4Option = document.querySelector('input[name="item4_option"]:checked').value;
      if(item4Option === "calc") {
        total += getHiddenValue("item4_score");
      } else {
        total += parseFloat(item4Option);
      }
      total += getRadioValue("item5");
      // Select items
      total += getSelectValue("item6");
      total += getSelectValue("item78");
      total += getSelectValue("item9");
      total += getSelectValue("item10");
      total += getRadioValue("item11");
      total += getSelectValue("item12");
      total += getSelectValue("item13");
      total += getSelectValue("item14");
      total += getRadioValue("item15");
      total += getSelectValue("item16");
      total += getRadioValue("item17");
      total += getRadioValue("item18");
      total += getSelectValue("item19");
      total += getSelectValue("item20");
      total += getSelectValue("item21");
      total += getSelectValue("item22");
      total += getSelectValue("item23");
      total += getSelectValue("item24");
      // Apply manual deduction for Item 24
      total -= parseFloat(document.getElementById('deduction24').value || 0);
      total += getSelectValue("item25");
      total += getSelectValue("item26");
      total += getSelectValue("item27a");
      total += getSelectValue("item27b");
      // Items 28 and 29 (radio buttons with extra deductions)
      total += getRadioValue("item28_option");
      total -= parseFloat(document.getElementById('deduction28').value || 0);
      total += getRadioValue("item29_option");
      total -= parseFloat(document.getElementById('deduction29').value || 0);
      
      document.getElementById('final_score_input').value = total;
      document.getElementById('final_score_display').innerText = "Final Score: " + total;
    }
  </script>

<!--- id="pdf-ref-icon" class="pdf-ref-icon">
  <a href="https://www.marines.mil/portals/1/mcrp%203-17.7f%20z.pdf" target="_blank" style="color: inherit; text-decoration: none;">PDF</a>
</div>
<!-- Fourth Calculator Icon (Concrete Calculator Trigger) -->


<!-- 
Original Modal Triggers (commented out):
<div id="manday-icon" class="manday-icon">MC</div>
<div id="calc-icon" class="calc-icon">Calc</div>
-->

<!-- Manday Capability Modal Structure -->
<div id="manday-modal" class="manday-modal">
  <div class="manday-content">
    <span id="manday-close" class="manday-close">&times;</span>
    <h2>Manday Capability Calculator</h2>
    <p>Calculate MD Capability: MC = DL × WD × ME × AF</p>
    <label for="dl_input">Direct Labor (DL):</label>
    <input type="number" id="dl_input" placeholder="Enter DL" step="1" min="0">
    
    <label for="wd_input">Available Workdays (WD):</label>
    <input type="number" id="wd_input" placeholder="Enter WD" step="1" min="0">
    
    <label for="me_input">Man-day Equivalent (ME):</label>
    <input type="number" id="me_input" placeholder="Enter ME" step="0.1" min="0">
    
    <label for="af_input">Availability Factor (AF):</label>
    <input type="number" id="af_input" placeholder="Enter AF (0-1)" step="0.01" min="0" max="1">
    
    <button id="manday-calc-button">Calculate MD Capability</button>
    <p id="manday-result">Result: </p>
  </div>
</div>

<!-- Calculator Modal -->
<div id="calc-modal" class="calc-modal">
  <div class="calc-content">
    <span id="calc-close" class="calc-close">&times;</span>
    <div class="calculator">
      <div class="display">
        <div id="previous-display" class="previous-display"></div>
        <div id="current-display" class="current-display">0</div>
      </div>
      <div class="buttons">
        <button class="button" onclick="clearDisplay()">C</button>
        <button class="button" onclick="appendOperator('/')">÷</button>
        <button class="button" onclick="appendOperator('*')">×</button>
        <button class="button" onclick="backspace()">⌫</button>

        <button class="button" onclick="appendNumber(7)">7</button>
        <button class="button" onclick="appendNumber(8)">8</button>
        <button class="button" onclick="appendNumber(9)">9</button>
        <button class="button" onclick="appendOperator('-')">−</button>

        <button class="button" onclick="appendNumber(4)">4</button>
        <button class="button" onclick="appendNumber(5)">5</button>
        <button class="button" onclick="appendNumber(6)">6</button>
        <button class="button" onclick="appendOperator('+')">+</button>

        <button class="button" onclick="appendNumber(1)">1</button>
        <button class="button" onclick="appendNumber(2)">2</button>
        <button class="button" onclick="appendNumber(3)">3</button>
        <button class="button" onclick="appendNumber('.')">.</button>

        <button class="button zero" onclick="appendNumber(0)">0</button>
        <button class="button equal" onclick="calculate()">=</button>
      </div>
    </div>
  </div>
</div>

<!-- Turnkey Tools Modal Snippet -->

<!-- Styles for the Tools container and icons -->
<!-- Turnkey Tools Modal Snippet with Additional Concrete Calculator -->

<!-- Styles for the Tools container and icons -->
<style>
  /* Ensure links inside icons inherit white text */
  .tools-container .pdf-ref-icon a,
  .tools-container .concrete-icon a {
    color: #fff !important;
    text-decoration: none;
  }
  /* Tools Modal Container */
  .tools-container {
    position: fixed;
    bottom: 20px;
    right: 20px;
    z-index: 1100;
    display: flex;
    flex-direction: column;
    align-items: flex-end;
  }
  .tools-icons {
    display: flex;
    flex-direction: row;
    justify-content: space-between;
    width: 200px; /* Adjust width to accommodate 4 icons */
    margin-bottom: 10px;
    opacity: 0;
    transform: translateY(20px);
    pointer-events: none;
    transition: opacity 0.3s ease, transform 0.3s ease;
  }
  .tools-icons.active {
    opacity: 1;
    transform: translateY(0);
    pointer-events: auto;
  }
  .tools-button {
    width: 50px;
    height: 50px;
    background: var(--primary-color);
    color: #fff;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    box-shadow: 0 2px 4px rgba(0,0,0,0.3);
    transition: background 0.3s;
  }
  .tools-button:hover {
    background: var(--primary-color-hover);
  }
  /* Override icon styles inside the Tools container */
  .tools-container .pdf-ref-icon,
  .tools-container .manday-icon,
  .tools-container .calc-icon,
  .tools-container .concrete-icon {
    position: static;
    width: 40px;
    height: 40px;
    background: var(--primary-color) !important;
    color: #fff !important;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    transition: background 0.3s;
    margin: 0;
  }
</style>

<!-- Tools container: wraps the modal triggers and the Tools button -->
<div class="tools-container">
  <!-- Container for the modal triggers (icons) -->
  <div id="toolsIcons" class="tools-icons">
    <!-- Manday Calc trigger -->
    <div id="manday-icon" class="manday-icon">MC</div>
    <!-- Calculator trigger -->
    <div id="calc-icon" class="calc-icon">Calc</div>
    <!-- Concrete Calculator trigger -->
    <div id="concrete-icon" class="concrete-icon">CY</div>
    <!-- PDF trigger -->
    <div id="pdf-ref-icon" class="pdf-ref-icon">
      <a href="https://www.marines.mil/portals/1/mcrp%203-17.7f%20z.pdf" target="_blank">PDF</a>
    </div>
  </div>
  <!-- Single Tools button -->
  <div id="toolsButton" class="tools-button">Tools</div>
</div>

<script>
  // Toggle the visibility of the icons container when the Tools button is clicked.
  document.getElementById('toolsButton').addEventListener('click', function(e) {
    e.stopPropagation(); // Prevent event bubbling
    var iconsContainer = document.getElementById('toolsIcons');
    iconsContainer.classList.toggle('active');
  });

  // Hide the icons if clicking outside the tools container.
  document.addEventListener('click', function(e) {
    var toolsContainer = document.querySelector('.tools-container');
    if (!toolsContainer.contains(e.target)) {
      document.getElementById('toolsIcons').classList.remove('active');
    }
  });
</script>

<!-- Concrete Calculator Modal -->
<style>
  .concrete-modal {
    display: none;
    position: fixed;
    z-index: 1002;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0,0,0,0.4);
  }
  .concrete-content {
    background-color: #fff;
    margin: 10% auto;
    padding: 20px;
    border: 1px solid #888;
    width: 90%;
    max-width: 400px;
    border-radius: 5px;
    text-align: center;
  }
  .concrete-close {
    color: #aaa;
    float: right;
    font-size: 28px;
    font-weight: bold;
    cursor: pointer;
    transition: color 0.3s;
  }
  .concrete-close:hover,
  .concrete-close:focus {
    color: black;
    text-decoration: none;
  }
</style>

<div id="concrete-modal" class="concrete-modal">
  <div class="concrete-content">
    <span id="concrete-close" class="concrete-close">&times;</span>
    <h2>Concrete Calculator</h2>
    <p>Calculate cubic yards of concrete needed:</p>
    <label for="length">Length (ft):</label>
    <input type="number" id="length" placeholder="Enter length in feet" step="any">
    <label for="width">Width (ft):</label>
    <input type="number" id="width" placeholder="Enter width in feet" step="any">
    <label for="thickness">Thickness (in):</label>
    <input type="number" id="thickness" placeholder="Enter thickness in inches" step="any">
    <button id="concrete-calc-button">Calculate Concrete</button>
    <p id="concrete-result">Cubic Yards: </p>
  </div>
</div>

<script>
  var concreteModal = document.getElementById("concrete-modal");
  var concreteIcon = document.getElementById("concrete-icon");
  var concreteClose = document.getElementById("concrete-close");
  var concreteCalcButton = document.getElementById("concrete-calc-button");
  var concreteResult = document.getElementById("concrete-result");

  concreteIcon.onclick = function() {
    concreteModal.style.display = "block";
  };

  concreteClose.onclick = function() {
    concreteModal.style.display = "none";
  };

  concreteCalcButton.onclick = function() {
    var length = parseFloat(document.getElementById("length").value) || 0;
    var width = parseFloat(document.getElementById("width").value) || 0;
    var thicknessInches = parseFloat(document.getElementById("thickness").value) || 0;
    var thicknessFeet = thicknessInches / 12;
    var cubicYards = (length * width * thicknessFeet) / 27;
    concreteResult.textContent = "Cubic Yards: " + cubicYards.toFixed(2);
  };
</script>


<!-- ---------- JavaScript for Modals ---------- -->
<script>
  // Manday Modal Script
  var mandayModal = document.getElementById("manday-modal");
  var mandayIcon = document.getElementById("manday-icon");
  var mandayClose = document.getElementById("manday-close");
  var mandayCalcButton = document.getElementById("manday-calc-button");
  var mandayResult = document.getElementById("manday-result");

  // Open manday modal when icon is clicked
  mandayIcon.onclick = function() {
    mandayModal.style.display = "block";
  };

  // Close manday modal when close button is clicked
  mandayClose.onclick = function() {
    mandayModal.style.display = "none";
  };

  // Calculation logic for MD Capability
  mandayCalcButton.onclick = function() {
    var dl = parseFloat(document.getElementById("dl_input").value) || 0;
    var wd = parseFloat(document.getElementById("wd_input").value) || 0;
    var me = parseFloat(document.getElementById("me_input").value) || 0;
    var af = parseFloat(document.getElementById("af_input").value) || 0;
    
    var capability = dl * wd * me * af;
    mandayResult.textContent = "Result: " + capability.toFixed(2) + " MDs";
  };

  /* ---------- Calculator Modal ---------- */
  var calcModal = document.getElementById("calc-modal");
  var calcIcon = document.getElementById("calc-icon");
  var calcClose = document.getElementById("calc-close");

  calcIcon.onclick = function() {
    calcModal.style.display = "block";
  };

  calcClose.onclick = function() {
    calcModal.style.display = "none";
  };

  // Combined window click handler for closing both modals if clicked outside
  window.addEventListener('click', function(event) {
    if (event.target == mandayModal) {
      mandayModal.style.display = "none";
    }
    if (event.target == calcModal) {
      calcModal.style.display = "none";
    }
  });

  // Calculator functionality
  let currentDisplay = document.getElementById('current-display');
  let previousDisplay = document.getElementById('previous-display');
  let currentInput = '';
  let operator = null;
  let previousInput = '';

  function clearDisplay() {
      currentInput = '';
      operator = null;
      previousInput = '';
      updateDisplay('0', '');
  }

  function appendNumber(number) {
      if (currentInput.includes('.') && number === '.') return;
      currentInput += number;
      updateDisplay(currentInput, previousInput !== '' ? `${previousInput} ${operator}` : '');
  }

  function appendOperator(op) {
      if (currentInput === '' && op === '-') {
          currentInput = '-';
          updateDisplay(currentInput, `${previousInput} ${operator}`);
          return;
      }
      if (currentInput === '') return;
      if (operator !== null) calculate();
      operator = op;
      previousInput = currentInput;
      currentInput = '';
      updateDisplay('', `${previousInput} ${operator}`);
  }

  function calculate() {
      if (operator === null || currentInput === '') return;
      let result;
      const prev = parseFloat(previousInput);
      const curr = parseFloat(currentInput);
      switch (operator) {
          case '+':
              result = prev + curr;
              break;
          case '-':
              result = prev - curr;
              break;
          case '*':
              result = prev * curr;
              break;
          case '/':
              result = prev / curr;
              break;
          default:
              return;
      }
      currentInput = result.toString();
      operator = null;
      previousInput = '';
      updateDisplay(currentInput, '');
  }

  function backspace() {
      currentInput = currentInput.slice(0, -1);
      updateDisplay(currentInput || '0', previousInput !== '' ? `${previousInput} ${operator}` : '');
  }

  function updateDisplay(current, previous = '') {
      currentDisplay.textContent = current;
      previousDisplay.textContent = previous;
  }

  clearDisplay();
</script>



    
</body>
</html>
